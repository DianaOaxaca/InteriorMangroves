[
  {
    "objectID": "01.Preprocessing.html",
    "href": "01.Preprocessing.html",
    "title": "Preprocessing",
    "section": "",
    "text": "Prior to conducting analyses that will elucidate the microbial dynamics associated with the mangroves under study, it is necessary to process the amplicon sequencing data. The following workflow was employed to achieve this purpose.\nFirst, the workspace was prepared:\nOnce the directories were prepared, the following steps were executed:",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "01.Preprocessing.html#remove-adapters",
    "href": "01.Preprocessing.html#remove-adapters",
    "title": "Preprocessing",
    "section": "01. Remove adapters",
    "text": "01. Remove adapters\n#Remove primers\n\nmkdir -p results/02.cutadapt\nout=\"results/02.cutadapt\"\nFASTQ=$(ls data/*.gz | sed 's/_.*//' | sed 's/data\\///' | sort -u)\n\ndate\n\nfor FILE in ${FASTQ[@]}; do\n    echo -e \"Run cutadapt to $FILE sample\"\n        CUTADAPT='cutadapt -m 200 --pair-filter any --no-indels -g CCTACGGGNGGCWGCAG -G GACTACHVGGGTATCTAATCC -Z -j 80 -o '$out'/'$FILE'_1.fastq.gz -p '$out'/'$FILE'_2.fastq.gz data/'$FILE'_R1.fastq.gz  data/'$FILE'_R2.fastq.gz'\n        echo -e $CUTADAPT \"\\n\"\n        $CUTADAPT\ndone",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "01.Preprocessing.html#get-asvs-with-dada2",
    "href": "01.Preprocessing.html#get-asvs-with-dada2",
    "title": "Preprocessing",
    "section": "02. Get ASVs with DADA2",
    "text": "02. Get ASVs with DADA2\n# Get path info\ngetwd()\n\n# Load packages\nlibrary(Rcpp)\nlibrary(dada2)\nlibrary(ggplot2)\nlibrary(gridExtra)\n\n##### 01. Prepare files -------------------------------------------------------\n\n#Load trim fastq files and list fastq_path content\nfastq_path &lt;- \"/axolote/diana/manglares/v0.2/results/02.cutadapt\"\nlist.files(fastq_path) \n\n#Sort file names\nFs &lt;- sort(list.files(fastq_path, pattern=\"_1.fastq\"))\nRs &lt;- sort(list.files(fastq_path, pattern=\"_2.fastq\"))\n\n# Extract sample names\nsampleNames &lt;- sapply(strsplit(Fs, \"_1\"), `[`, 1)\nsampleNames\n\n# Add complete path to remove ambiguities errors\nFs &lt;- file.path(fastq_path, Fs)\nRs &lt;- file.path(fastq_path, Rs)\n\n##### 02. Check Quality --------------------------------------------------------\n\n# Quality check plot with only the first fastq file\nQC_F1_15 &lt;- plotQualityProfile(Fs[1:15], aggregate = TRUE)\nQC_R1_15 &lt;- plotQualityProfile(Rs[1:15], aggregate = TRUE)\nQCsFR1_15 &lt;- grid.arrange(QC_F1_15, QC_R1_15, nrow = 1)\n\n#save in png format\nggsave(\"results/plots/01.QualityProfile_1-15.png\", QCsFR1_15, width = 7, height = 3)\n\n#save in pdf format\nQCsFR1_15 &lt;- grid.arrange(QC_F1_15, QC_R1_15, nrow = 1)\nggsave(\"results/plots/01.QualityProfile_1-15.pdf\", QCsFR1_15, width = 7, height = 3)\n\n##### 03.Quality control -------------------------------------------------------\n\n# Create directory for clean reads\nfilt_path &lt;- file.path(\"results/03.Dada2\" , \"01.filter_reads\") \nif(!file_test(\"-d\", filt_path)) \n  dir.create(filt_path)\nfiltFs &lt;- file.path(filt_path, paste0(sampleNames, \"_F_filt.fastq.gz\"))\nfiltRs &lt;- file.path(filt_path, paste0(sampleNames, \"_R_filt.fastq.gz\"))\n\n# Filter versions\n\n# V1 \nout1 &lt;- filterAndTrim(Fs, filtFs, Rs, filtRs,\n                      truncLen=c(250,200),\n                      maxN=0, maxEE=c(5,5), truncQ=2, rm.phix=TRUE,\n                      compress=TRUE, multithread=TRUE) \nhead(out1)\n\n#V2 extra permissive\nout2 &lt;- filterAndTrim(Fs, filtFs, Rs, filtRs,\n                      maxN=0, maxEE=c(5,5), truncQ=2, rm.phix=TRUE,\n                      compress=TRUE, multithread=TRUE) \nhead(out2)\n\n#V3\nout3 &lt;- filterAndTrim(Fs, filtFs, Rs, filtRs,\n                      truncLen=c(280,200),\n                      maxN=0, maxEE=c(5,5), truncQ=2, rm.phix=TRUE,\n                      compress=TRUE, multithread=TRUE) \nhead(out3)\n\n##v4\nout4 &lt;- filterAndTrim(Fs, filtFs, Rs, filtRs,\n                      truncLen=c(0,200),\n                      maxN=0, maxEE=c(5,5), truncQ=2, rm.phix=TRUE,\n                      compress=TRUE, multithread=TRUE) \nhead(out4)\n\n##v5\nout5 &lt;- filterAndTrim(Fs, filtFs, Rs, filtRs,\n                      truncLen=c(260,200),\n                      maxN=0, maxEE=c(5,5), truncQ=2, rm.phix=TRUE,\n                      compress=TRUE, multithread=TRUE)\nhead(out5)\n\n## compare trunc versions\nv1 &lt;- as.data.frame(out1)\nv2 &lt;- as.data.frame(out2)\nv3 &lt;- as.data.frame(out3)\nv4 &lt;- as.data.frame(out4)\nv5 &lt;- as.data.frame(out5)\n\n\n# Percentage function\ncalculate_percentage &lt;- function(df, group_name) {\n  df$percentage &lt;- (df$reads.out / df$reads.in) * 100\n  df$version &lt;- group_name\n  return(df)\n}\n\n# Get percentage\nout1_with_percentage &lt;- calculate_percentage(v1, 'v1:250-200')\nout2_with_percentage &lt;- calculate_percentage(v2, 'v2:0-0')\nout3_with_percentage &lt;- calculate_percentage(v3, 'v3:280-200')\nout4_with_percentage &lt;- calculate_percentage(v4, 'v4:0-200')\nout5_with_percentage &lt;- calculate_percentage(v5, 'v5:260-200')\n\n# Combine percentage versions\ncombined_data &lt;- rbind(out1_with_percentage, out2_with_percentage, \n                       out3_with_percentage, out4_with_percentage,\n                       out5_with_percentage)\n\n# Compare plot\nboxplot_versions &lt;- ggplot(combined_data, aes(x = version, y = percentage, \n                    fill = version)) + geom_boxplot() + theme_bw() +\n  labs(x = \"Filter version\", y = \"Percentage of reads after filter\") +\n  scale_fill_brewer(palette = \"Set2\")\n\nboxplot_versions\n\n#save plot as png\nggsave(\"results/plots/02.boxplot_trunc_versions.png\", boxplot_versions, width = 6)\n\n#save plot as pdf\nggsave(\"results/plots/02.boxplot_trunc_versions.pdf\", boxplot_versions, width = 6)\n\n#Save info of final version\n#We chose v5 \nwrite.table(out5_with_percentage, file=\"results/03.Dada2/Dada_clean_reads.tsv\", quote=F, sep=\"\\t\",col.names=NA) # Table with the totals before and after cleaning\n\n##### 04.Error Model -----------------------------------------------------------\n\n#De-replicate to reduce redundance \n\nderepFs &lt;- derepFastq(filtFs, verbose=TRUE)\nderepRs &lt;- derepFastq(filtRs, verbose=TRUE)\n\n# Add names to de-rep object\nnames(derepFs) &lt;- sampleNames\nnames(derepRs) &lt;- sampleNames\n\n#Generate Error model IMPORTANT\nerrF &lt;- learnErrors(derepFs, multithread=TRUE, verbose = TRUE)\nerrR &lt;- learnErrors(derepRs, multithread=TRUE, verbose=TRUE)\n\nsave.image(file = \"src/Dada2.RData\") # Save point to stop for now\n\n##### 0.5 Get ASVs -------------------------------------------------------------\n# ASVs inference\ndadaFs &lt;- dada(derepFs, err=errF, multithread=TRUE, pool = \"pseudo\", verbose=TRUE)\ndadaRs &lt;- dada(derepRs, err=errR, multithread=TRUE, pool = \"pseudo\", verbose = TRUE)\n\nsave.image(file = \"src/Dada2.RData\") # Save point to stop for now\n\n# Merge pairs\nmergers &lt;- mergePairs(dadaFs, derepFs, dadaRs, derepRs, minOverlap = 8, verbose=TRUE)\n\n# Create ASVs table \nseqtabAll &lt;- makeSequenceTable(mergers)\ntable(nchar(getSequences(seqtabAll)))\n\n# Remove chimeras\nseqtab_nochim &lt;- removeBimeraDenovo(seqtabAll, method=\"consensus\", multithread=TRUE, verbose=TRUE)\n\ndim(seqtab_nochim)\nsum(seqtab_nochim)/sum(seqtabAll)\n\n##### 0.6 info -----------------------------------------------------------------\n\n# create a new table with each ASV number and its representative sequence\nPE.table_tsv_output &lt;- seqtab_nochim\nPE.table_tsv_output[PE.table_tsv_output==1]=0 # Don't consider those values that have a single observation per sample, make them 0 (sample singletons)\nPE.table_tsv_output &lt;- PE.table_tsv_output[,colSums(PE.table_tsv_output)&gt;1] # filter singleton ASVs across the table\n\n# Export sequences as in fasta format\nuniquesToFasta(PE.table_tsv_output, fout=\"results/03.Dada2/ASVs.fasta\", ids=paste(\"ASV_\",1:ncol(PE.table_tsv_output), sep=\"\"))\nnochim=PE.table_tsv_output\nwrite.table(cbind(\"ASVs\"=1:nrow(t(PE.table_tsv_output)),\"rep_seq\"=rownames(t(PE.table_tsv_output))), file=\"results/03.Dada2/ASV_to_seqs-nochim.tsv\", quote=F, sep=\"\\t\",row.names=FALSE)\n\n# replace the rep_seq with an incremental ASV number\nPE.table_tsv_output &lt;- t(PE.table_tsv_output)\nrownames(PE.table_tsv_output) &lt;- paste0(\"ASV_\",1:nrow(PE.table_tsv_output))\n\n# and print the output ASV table\nwrite.table(PE.table_tsv_output, file=\"results/03.Dada2/ASV_to_seqs-nochim.tsv\", quote=F, sep=\"\\t\",col.names=NA)\n\n# evaluate the total table dimensions\ndim(nochim)\n\ntable(nchar(getSequences(nochim))) \n\n###Track reads lost per step ###\n\n# By using this, we can create a function to automate this for all samples in a set:\ngetN &lt;- function(x) sum(getUniques(x)) # Where getUniques gets non-repeated sequences from a dada2 object or merger object (joined reads)\ntrack &lt;- cbind(out1, sapply(derepFs, getN), sapply(dadaFs, getN), sapply(dadaRs, getN), rowSums(seqtabAll), rowSums(nochim))\ncolnames(track) &lt;- c(\"Raw\", \"Qual_filter\", \"Derep\", \"ASVs R1\", \"ASVs R2\", \"Merged\", \"nonchim\")\nrownames(track) &lt;- sampleNames\nwrite.table(track, \"results/03.Dada2/Seqs_lost_in_ASVs_processing.tsv\", col.names=NA, sep=\"\\t\")\n\n\n# Create a quick assesment of sequences lost throughout the process\npng(\"results/plots/03.preview_reads_passing_ASV_processing.png\")\n# And same thing for the percentage remaining\nmatplot(t(track[,-5]/track[,1]*100),type='l',xaxt='n', main=\"Sequences remaining after each step  - R1 (%)\", xlab=\"Step\", ylab=\" Percentage of Sequences remaining\")\naxis(1,at=1:ncol(track[,-5]),labels=colnames(track[,-5]))\n# R2\nmatplot(t(track[,-4]/track[,1]*100),type='l',xaxt='n', main=\"Sequences remaining after each step  - R2 (%)\", xlab=\"Step\", ylab=\" Percentage of Sequences remaining\")\naxis(1,at=1:ncol(track[,-4]),labels=colnames(track[,-4]))\ndev.off()\n\n##Add final table\ntrack2 &lt;- data.frame(track)\ntrack2$percentage_used &lt;-(track2$nonchim / track2$Raw) * 100\ntrack2\nwrite.table(track2, \"results/03.Dada2/Seqs_lost_in_ASVs_processing_percentage.tsv\", col.names=NA, sep=\"\\t\")\n\n# Save work so far\nsave.image(file = \"src/Dada2.RData\")",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "01.Preprocessing.html#import-to-qiime2",
    "href": "01.Preprocessing.html#import-to-qiime2",
    "title": "Preprocessing",
    "section": "03. Import to QIIME2",
    "text": "03. Import to QIIME2\n#!/usr/bin/bash\n## DianaOaxaca\n## Import data to QIIME2\n\n#Run in qiime conda environment\n#conda activate qiime2-2023.5\n\n#import rep seqs\nqiime tools import --input-path results/03.Dada2/ASVs.fasta --type 'FeatureData[Sequence]' --output-path results/04.qiime/ASV_rep_seq.qza\n\n# append missing header to the table for import\ncat &lt;(echo -n \"#OTU Table\") results/03.Dada2/ASV_to_seqs-nochim.tsv &gt; temp.txt\n\n# convert to biom\nbiom convert -i temp.txt -o temp.biom --table-type=\"OTU table\" --to-hdf5\n\n# and create table-type qza\nqiime tools import --input-path temp.biom --type 'FeatureTable[Frequency]' --input-format BIOMV210Format --output-path results/04.qiime/ASV_table.qza\n\n# remove temporal files\nrm temp.*",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "01.Preprocessing.html#taxonomic-assignment",
    "href": "01.Preprocessing.html#taxonomic-assignment",
    "title": "Preprocessing",
    "section": "04. Taxonomic assignment",
    "text": "04. Taxonomic assignment\n#!/usr/bin/bash\n## DianaOaxaca\n## Import data to QIIME2\n\n#Run in qiime conda environment\n#conda activate qiime2-2023.5\n\n#import rep seqs\nqiime tools import --input-path results/03.Dada2/ASVs.fasta --type 'FeatureData[Sequence]' --output-path results/04.qiime/ASV_rep_seq.qza\n\n# append missing header to the table for import\ncat &lt;(echo -n \"#OTU Table\") results/03.Dada2/ASV_to_seqs-nochim.tsv &gt; temp.txt\n\n# convert to biom\nbiom convert -i temp.txt -o temp.biom --table-type=\"OTU table\" --to-hdf5\n\n# and create table-type qza\nqiime tools import --input-path temp.biom --type 'FeatureTable[Frequency]' --input-format BIOMV210Format --output-path results/04.qiime/ASV_table.qza\n\n# remove temporal files\nrm temp.*",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "01.Preprocessing.html#filters",
    "href": "01.Preprocessing.html#filters",
    "title": "Preprocessing",
    "section": "05. Filters",
    "text": "05. Filters\n#!/usr/bin/bash\n#DianaOaxaca\n#Filters\n\n#Summary of the qza table imported from R\nqiime feature-table summarize \\\n--i-table results/04.qiime/ASV_table.qza \\\n--o-visualization results/04.qiime/ASV_table.qzv\n\n#Filter by frequency\n#Here I removed all ASVs with a frequency of less than 0.1% of the mean sample depth. \n#This cut-off excludes ASVs that are likely due to MiSeq bleed-through between runs (reported by Illumina to be 0.1% of reads). \n#To calculate this cut-off I identified the mean sample depth, multiplied it by 0.001, and rounded to the nearest integer. \n#This step are describe in [this paper](https://journals.asm.org/doi/pdf/10.1128/msystems.00127-16)\n\nqiime feature-table filter-features --i-table  results/04.qiime/ASV_table.qza \\\n --p-min-samples 1 --p-min-frequency 218 --o-filtered-table results/04.qiime/ASV_table_filter_freq218.qza\n\nqiime feature-table summarize --i-table results/04.qiime/ASV_table_filter_freq218.qza \\\n --o-visualization results/04.qiime/ASV_table_filter_freq218.qzv\n\n#Filter Mitochondria, chloroplast and Eukaryota\n\nqiime taxa filter-table --i-table results/04.qiime/ASV_table_filter_freq218.qza \\\n --i-taxonomy results/04.qiime/taxonomy.qza --p-exclude Eukaryota,Mitochondria,Chloroplast \\\n --p-include p__ --o-filtered-table results/04.qiime/ASV_table_filter_freq218_emc.qza\n\nqiime feature-table summarize --i-table results/04.qiime/ASV_table_filter_freq218_emc.qza \\\n --o-visualization results/04.qiime/ASV_table_filter_freq218_emc.qzv\n\n#remove in fasta sequences\nqiime feature-table filter-seqs  --i-table results/04.qiime/ASV_table_filter_freq218_emc.qza \\\n --i-data results/04.qiime/ASV_rep_seq.qza --o-filtered-data results/04.qiime/ASV_rep_seq_filters.qza",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "01.Preprocessing.html#phylogeny",
    "href": "01.Preprocessing.html#phylogeny",
    "title": "Preprocessing",
    "section": "06. Phylogeny",
    "text": "06. Phylogeny\n#!/usr/bin/bash\n#Get iqtree phylogeny\n\ndate\necho \"Start phylogeny\"\n\nqiime phylogeny align-to-tree-mafft-iqtree \\\n --p-n-threads auto --i-sequences results/04.qiime/ASV_rep_seq_filters.qza \\\n --o-alignment results/04.qiime/align.qza \\\n --o-masked-alignment results/04.qiime/masked-align.qza \\\n --o-tree results/04.qiime/unrooted-tree-iqtree.qza \\\n --o-rooted-tree results/04.qiime/rooted-tree-iqtree.qza --verbose\n\necho \"finish phylogeny!\"\n\ndate",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "01.Preprocessing.html#get-public-data",
    "href": "01.Preprocessing.html#get-public-data",
    "title": "Preprocessing",
    "section": "07. Get public data",
    "text": "07. Get public data\n# Yaxche\n\n\n\n\n\n\nPublic data preprocessing\n\n\n\nThe public data obtained for comparative purposes was preprocessed in the same way as described in the previous steps.",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "01.Preprocessing.html#clustering-types-of-mangroves-for-comparative-analysis",
    "href": "01.Preprocessing.html#clustering-types-of-mangroves-for-comparative-analysis",
    "title": "Preprocessing",
    "section": "08. Clustering types of mangroves for comparative analysis",
    "text": "08. Clustering types of mangroves for comparative analysis\n#Run in qiime conda environment\nconda activate qiime2-2023.5\n\n#Repeat with every ASV_table (Celestún, Estero Pargo and San Pedro River)\n#import rep seqs\nqiime tools import --input-path results/03.Dada2/ASVs.fasta --type 'FeatureData[Sequence]' --output-path results/04.qiime/ASV_rep_seq.qza\n\n# append missing header to the table for import\ncat &lt;(echo -n \"#OTU Table\") results/03.Dada2/ASV_to_seqs-nochim.tsv &gt; temp.txt\n\n# convert to biom\nbiom convert -i temp.txt -o temp.biom --table-type=\"OTU table\" --to-hdf5\n\n# and create table-type qza\nqiime tools import --input-path temp.biom --type 'FeatureTable[Frequency]' --input-format BIOMV210Format --output-path results/04.qiime/ASV_table.qza\n\n# remove temporal files\nrm temp.*\n\n#Merge of the frequency tables from distinct analysis\nqiime feature-table merge \n--i-tables ASV_table_Celestun.qza ASV_table_Estero.qza ASV_table_SanPedro.qza --p-overlap-method sum \n--o-merged-table merged-table.qza\n\n#Merge of the Representative sequences from distinct analysis \nqiime feature-table merge-seqs \n--i-data ASV_Celestun_rep_seq.qza ASV_Estero_rep_seq.qza ASV_SanPedro_rep_seq.qza \n--o-merged-data merged-rep_seqs.qza\n\n#Closed reference clustering for Meta-Analysis\nqiime vsearch cluster-features-closed-reference   \n--i-table merged-table.qza   \n--i-sequences merged-rep_seqs.qza   \n--i-reference-sequences silva-138-99-seqs.qza   \n--p-perc-identity 0.97   \n--o-clustered-table table-cr-97.qza   \n--o-clustered-sequences rep-seqs-cr-97.qza   \n--o-unmatched-sequences unmatched-cr-97.qza\n\n#Taxonomic assignment with SILVA\n qiime feature-classifier classify-sklearn   \n--i-classifier classifier_silva_138_trained.qza   \n--i-reads rep-seqs-cr-97.qza    \n--o-classification taxonomyEstero.qza \n--p-n-jobs 40\n\n#Filter by frequency\nqiime feature-table filter-features --i-table  merged_table.qza \n--p-min-samples 1 \n--p-min-frequency 218 \n--o-filtered-table clustered_table_filter_freq218.qza\n\n#Filter Mitochondria, chloroplast and Eukaryota\nqiime taxa filter-table \n--i-table Clustered_table_filter_freq218.qza \n--i-taxonomy taxonomy.qza \n--p-exclude Eukaryota,Mitochondria,Chloroplast  \n--p-include p__ \n--o-filtered-table clustered_table_filter_freq218_emcEstero.qza",
    "crumbs": [
      "Preprocessing"
    ]
  },
  {
    "objectID": "02.1.AlphaDiversity.html",
    "href": "02.1.AlphaDiversity.html",
    "title": "Alpha diversity",
    "section": "",
    "text": "Tip\n\n\n\nAlpha diversity indices were calculated with Hill numbers (q0 = observed richness, q1 = Shannon Exp and q2 = Inv Simpson). The significance of the observed differences among mangrove systems was determined by employing a linear model, given the imbalanced sample numbers.",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Alpha diversity"
    ]
  },
  {
    "objectID": "02.1.AlphaDiversity.html#load-libraries-and-prepare-data",
    "href": "02.1.AlphaDiversity.html#load-libraries-and-prepare-data",
    "title": "Alpha diversity",
    "section": "Load libraries and prepare data",
    "text": "Load libraries and prepare data\n\n#Load libraries\nlibrary(phyloseq)\nlibrary(hilldiv)\nlibrary(tidyverse)\nlibrary(ggpubr)\nlibrary(ggplot2)\nlibrary(cowplot)\nlibrary(vegan)\nlibrary(emmeans)\nlibrary(multcomp)\n\n\n#load data\nphyseq_qiime3 &lt;- readRDS(\"rds/compare_mangroves/physeq_qiime3.rds\")\n\n\n#Mangrove system colors\nloc_colors &lt;- c(\"Fossil Lagoon\"= \"#A7fcc1\",\n                \"San Pedro River\" = \"#26B170\",\n                \"Términos Lagoon\" = \"#329D9C\",\n                \"Celestún Lagoon\" = \"#41e8d3\")\n\n\n# Extract data from phyloseq object\n#library(phyloseq)\notu_data &lt;- otu_table(physeq_qiime3, taxa_are_rows = TRUE)\nmetadata &lt;- as(sample_data(physeq_qiime3), \"data.frame\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Alpha diversity"
    ]
  },
  {
    "objectID": "02.1.AlphaDiversity.html#get-hill-numbers",
    "href": "02.1.AlphaDiversity.html#get-hill-numbers",
    "title": "Alpha diversity",
    "section": "01. Get Hill numbers",
    "text": "01. Get Hill numbers\n\n# Calculate hill numbers\n#library(hilldiv)\n\nq0 &lt;- hill_div(otu_data, qvalue = 0)\nq1 &lt;- hill_div(otu_data, qvalue = 1)\nq2 &lt;- hill_div(otu_data, qvalue = 2)\n\n# Merge metadata with Hill numbers\n#library(tidyverse)\nq012 &lt;- cbind(q0, q1, q2) %&gt;% as.data.frame() %&gt;%\n  rownames_to_column(var = \"SampleID\")\n\n# join\nmetadata_with_hill &lt;- q012 %&gt;%\n  inner_join(metadata, by = c(\"SampleID\"=\"SampleID\"))\n\n# show\nmetadata_with_hill %&gt;% head()\n\n  SampleID   q0  q1    q2 BioSample  ID    SRA SampleName Collection_date depth\n1   S1A015 1266 330 106.0    S1A015 RSP S1A015                 2023-09-28  0-15\n2    S1B07 1502 164  36.0     S1B07 RSP  S1B07                 2023-09-28  0-15\n3    S2B07 1378 351 106.8     S2B07 RSP  S2B07                 2023-09-28  0-15\n4    S3A07 1190 154  37.6     S3A07 RSP  S3A07                 2023-09-28  0-15\n5    S4B07 1563 388 120.4     S4B07 RSP  S4B07                 2023-09-29  0-15\n6    S5A07 1160 131  32.1     S5A07 RSP  S5A07                 2023-09-29  0-15\n  site elevation Broad_scale_environmental_context\n1   1A        NA                                  \n2   1B        NA                                  \n3   2B        NA                                  \n4   3A        NA                                  \n5   4B        NA                                  \n6   5A        NA                                  \n  Local_scale_environmental_context Environmental_medium Latitude_and_Longitude\n1                                                                              \n2                                                                              \n3                                                                              \n4                                                                              \n5                                                                              \n6                                                                              \n  Geographic.Location    Study_zone Ecological_type Parametros Temperatura\n1      Mexico:Tabasco Rio San Pedro          Fringe         no          NA\n2      Mexico:Tabasco Rio San Pedro          Fringe         no          NA\n3      Mexico:Tabasco Rio San Pedro          Fringe         no          NA\n4      Mexico:Tabasco Rio San Pedro          Fringe         no          NA\n5      Mexico:Tabasco Rio San Pedro          Fringe         no          NA\n6      Mexico:Tabasco Rio San Pedro          Fringe         no          NA\n  Salinidad pH Redox.mV S.2 SO4 season filter Mangrove.system Mangrove_type\n1        NA NA       NA  NA  NA  flood     si San Pedro River      Interior\n2        NA NA       NA  NA  NA  flood     si San Pedro River      Interior\n3        NA NA       NA  NA  NA  flood     si San Pedro River      Interior\n4        NA NA       NA  NA  NA  flood     si San Pedro River      Interior\n5        NA NA       NA  NA  NA  flood     si San Pedro River      Interior\n6        NA NA       NA  NA  NA  flood     si San Pedro River      Interior\n\n#save table\nwrite.table(metadata_with_hill, \"Tables/SurfaceComparison/Metadata_with_hill.tsv\",\n            quote = FALSE, sep = \"\\t\", row.names = TRUE, col.names=TRUE)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Alpha diversity"
    ]
  },
  {
    "objectID": "02.1.AlphaDiversity.html#get-hill-means",
    "href": "02.1.AlphaDiversity.html#get-hill-means",
    "title": "Alpha diversity",
    "section": "02. Get Hill means",
    "text": "02. Get Hill means\n\n# Reorder q values\nmeta_qs &lt;- metadata_with_hill %&gt;%\n  pivot_longer(cols = q0:q2, names_to = \"q\", values_to = \"value\") %&gt;%\n  filter(q %in% c(\"q0\", \"q1\", \"q2\")) %&gt;%\n  mutate(\n    qs = case_when(\n      q == \"q0\" ~ \"q0=Observed\",\n      q == \"q1\" ~ \"q1=Exp Shannon\",\n      q == \"q2\" ~ \"q2=Inv Simpson\",\n    ))\n\n#Get means of Hill numbers\nmeans &lt;- meta_qs %&gt;% group_by(Mangrove_type, Mangrove.system, qs) %&gt;%\n  summarise(means = mean(value, na.rm = TRUE),\n            sd = sd(value, na.rm = TRUE),\n            .groups = 'drop')\n\nprint(means)\n\n# A tibble: 12 × 5\n   Mangrove_type Mangrove.system qs              means    sd\n   &lt;chr&gt;         &lt;chr&gt;           &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;\n 1 Coastal       Celestún Lagoon q0=Observed    1202   207. \n 2 Coastal       Celestún Lagoon q1=Exp Shannon  496.   87.6\n 3 Coastal       Celestún Lagoon q2=Inv Simpson  234.   40.5\n 4 Coastal       Términos Lagoon q0=Observed     140    61.8\n 5 Coastal       Términos Lagoon q1=Exp Shannon   78.8  48.9\n 6 Coastal       Términos Lagoon q2=Inv Simpson   51.2  32.7\n 7 Interior      Fossil Lagoon   q0=Observed    1230   134. \n 8 Interior      Fossil Lagoon   q1=Exp Shannon  300.   75.1\n 9 Interior      Fossil Lagoon   q2=Inv Simpson   86.5  26.9\n10 Interior      San Pedro River q0=Observed    1368.  166. \n11 Interior      San Pedro River q1=Exp Shannon  254.  105. \n12 Interior      San Pedro River q2=Inv Simpson   71.7  38.4\n\n#save table\nwrite.table(means, \"Tables/SurfaceComparison/Hill_means_sd.tsv\", quote = FALSE,\n            sep = \"\\t\", row.names = TRUE, col.names=TRUE)\n\n# group by mangrove type\nmeans_mangrove_type &lt;- meta_qs %&gt;% group_by(Mangrove_type, qs) %&gt;%\n  summarise(means = mean(value, na.rm = TRUE),\n            sd = sd(value, na.rm = TRUE),\n            .groups = 'drop')\n\nprint(means_mangrove_type)\n\n# A tibble: 6 × 4\n  Mangrove_type qs              means    sd\n  &lt;chr&gt;         &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;\n1 Coastal       q0=Observed     974.  488. \n2 Coastal       q1=Exp Shannon  407.  195. \n3 Coastal       q2=Inv Simpson  194.   86.3\n4 Interior      q0=Observed    1318.  163. \n5 Interior      q1=Exp Shannon  271.   94.0\n6 Interior      q2=Inv Simpson   77.1  34.0\n\nwrite.table(means, \"Tables/SurfaceComparison/Hill_means_sd_mangrove_type.tsv\", quote = FALSE,\n            sep = \"\\t\", row.names = TRUE, col.names=TRUE)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Alpha diversity"
    ]
  },
  {
    "objectID": "02.1.AlphaDiversity.html#get-sequencing-effort",
    "href": "02.1.AlphaDiversity.html#get-sequencing-effort",
    "title": "Alpha diversity",
    "section": "03. Get sequencing effort",
    "text": "03. Get sequencing effort\n\n### Sample effort\n#library(vegan)\nmat &lt;- as(t(otu_table(physeq_qiime3)), \"matrix\")\nraremax &lt;- min(rowSums(mat))\n\n# plot\nsystem.time(rarecurve(mat, step = 100, sample = raremax, col = \"green4\", \n                      label = FALSE))\n\n\n\n\n\n\n\n   user  system elapsed \n  4.705   0.123   4.852 \n\n# save\npdf(\"Figures/SurfaceComparison/sample_effort.pdf\")\nsystem.time(rarecurve(mat, step = 100, sample = raremax, col = \"green4\", \n                      label = FALSE))\n\n   user  system elapsed \n  4.971   0.174   5.293 \n\ndev.off()\n\nquartz_off_screen \n                2",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Alpha diversity"
    ]
  },
  {
    "objectID": "02.1.AlphaDiversity.html#get-significant-differences",
    "href": "02.1.AlphaDiversity.html#get-significant-differences",
    "title": "Alpha diversity",
    "section": "04. Get significant differences",
    "text": "04. Get significant differences\n\n\n\n\n\n\nRemember\n\n\n\nThe significance of the observed differences among mangrove systems was determined by employing a linear model, given the imbalanced sample numbers.\n\n\n\n# change variable to factor\nmetadata_with_hill$Mangrove.system &lt;- \n  factor(metadata_with_hill$Mangrove.system)\n\n# Change to Fossil Lagoon reference\nmetadata_with_hill$Mangrove.system &lt;- \n  relevel(metadata_with_hill$Mangrove.system,ref = \"Fossil Lagoon\")\n\nq0 Observed richness\n\n# linear model adjust\nq0lm &lt;- lm(q0 ~ Mangrove.system, data = metadata_with_hill)\n# summary\nsummary(q0lm)\n\n\nCall:\nlm(formula = q0 ~ Mangrove.system, data = metadata_with_hill)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-334.0 -102.4    9.6  140.0  247.0 \n\nCoefficients:\n                               Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)                      1230.0       88.3   13.93  4.5e-12 ***\nMangrove.systemCelestún Lagoon    -28.0      103.1   -0.27     0.79    \nMangrove.systemSan Pedro River    138.4      110.7    1.25     0.22    \nMangrove.systemTérminos Lagoon  -1090.0      134.9   -8.08  7.0e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 177 on 21 degrees of freedom\nMultiple R-squared:  0.84,  Adjusted R-squared:  0.817 \nF-statistic: 36.7 on 3 and 21 DF,  p-value: 1.56e-08\n\n# check model reliability\nshapiro.test(residuals(q0lm))\n\n\n    Shapiro-Wilk normality test\n\ndata:  residuals(q0lm)\nW = 1, p-value = 0.4\n\n\n\n# get differences with emmeans\n#library(emmeans)\nq0_lm_means &lt;- emmeans(q0lm, pairwise ~ Mangrove.system)\n\n# get significance letters\n#library(multcomp)\ncld_results &lt;- cld(object = q0_lm_means$emmeans, Letters = letters)\n\n# Convertir a data frame\nq0_emmeans_df &lt;- as.data.frame(cld_results)\nq0_emmeans_df\n\n Mangrove.system emmean    SE df lower.CL upper.CL .group\n Términos Lagoon    140 102.0 21      -72      352  a    \n Celestún Lagoon   1202  53.3 21     1091     1313   b   \n Fossil Lagoon     1230  88.3 21     1046     1414   b   \n San Pedro River   1368  66.8 21     1230     1507   b   \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 4 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n\n# Reorder samples\nmetadata_with_hill$Mangrove.system &lt;- factor(\n  metadata_with_hill$Mangrove.system,\n  levels = c(\"Fossil Lagoon\", \"San Pedro River\", \n             \"Términos Lagoon\", \"Celestún Lagoon\"))\n\n\n# boxplot with significance\nq0plot &lt;- ggplot(metadata_with_hill, aes(x = Mangrove.system, y = q0, fill = Mangrove.system)) +\n  geom_boxplot() +\n  #geom_jitter(aes(fill = Mangrove.system), width = 0.1, alpha = 0.4) +\n  geom_text(data = q0_emmeans_df, aes(y = emmean, label = .group), vjust = -3,\n          color = \"black\", fontface = \"bold\", position = position_dodge(0.9)) +\n  labs(title = \"q0 = Observed\", y = NULL, x = NULL) + #,\n  #caption = \"letters by lm emmeans\") +\n  theme_classic() + scale_fill_manual(values = loc_colors) +\n  theme(legend.position = \"none\", axis.text.x = element_blank())\n\nq1 Diversity Exp Shannon\n\n# linear model\nq1lm &lt;- lm(q1 ~ Mangrove.system, data = metadata_with_hill)\n\n# summary\nsummary(q1lm)\n\n\nCall:\nlm(formula = q1 ~ Mangrove.system, data = metadata_with_hill)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-131.78  -90.32    8.03   70.63  150.27 \n\nCoefficients:\n                               Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)                       300.0       44.3    6.77  1.1e-06 ***\nMangrove.systemSan Pedro River    -45.6       55.5   -0.82   0.4209    \nMangrove.systemTérminos Lagoon   -221.2       67.6   -3.27   0.0037 ** \nMangrove.systemCelestún Lagoon    196.2       51.7    3.79   0.0011 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 88.6 on 21 degrees of freedom\nMultiple R-squared:  0.763, Adjusted R-squared:  0.729 \nF-statistic: 22.5 on 3 and 21 DF,  p-value: 9.24e-07\n\n#check model reliability\nshapiro.test(residuals(q1lm))\n\n\n    Shapiro-Wilk normality test\n\ndata:  residuals(q1lm)\nW = 0.9, p-value = 0.2\n\n# significance\nq1_lm_means &lt;- emmeans(q1lm, pairwise ~ Mangrove.system)\ncld_results &lt;- cld(object = q1_lm_means$emmeans, Letters = letters)\n\n# Convert to data frame\nq1_emmeans_df &lt;- as.data.frame(cld_results)\nq1_emmeans_df\n\n Mangrove.system emmean   SE df lower.CL upper.CL .group\n Términos Lagoon     79 51.1 21      -28      185  a    \n San Pedro River    254 33.5 21      185      324   b   \n Fossil Lagoon      300 44.3 21      208      392   b   \n Celestún Lagoon    496 26.7 21      441      552    c  \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 4 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n\n\n\n# boxplot\nq1plot &lt;- ggplot(metadata_with_hill, aes(x = Mangrove.system , y = q1, fill = Mangrove.system)) +\n  geom_boxplot() +\n  #geom_jitter(aes(fill = Mangrove.system), width = 0.1, alpha = 0.4) +\n  geom_text(data = q1_emmeans_df, aes(y = emmean, label = .group), vjust = -5,\n          color = \"black\", fontface = \"bold\", position = position_dodge(0.9)) +   labs(title = \"q1 = Exp Shannon\", y = NULL, x = NULL) + #,\n  #caption = \"letters by lm emmeans\") +\n  theme_classic() + scale_fill_manual(values = loc_colors) +\n  theme(legend.position = \"none\", axis.text.x = element_blank())\n\nq2 Dominance Inv Simpson\n\n# Model\nq2lm &lt;- lm(q2 ~ Mangrove.system, data = metadata_with_hill)\n\n# summary\nsummary(q2lm)\n\n\nCall:\nlm(formula = q2 ~ Mangrove.system, data = metadata_with_hill)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-54.83 -34.13  -3.61  19.39  88.13 \n\nCoefficients:\n                               Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)                        86.5       18.7    4.62  0.00015 ***\nMangrove.systemSan Pedro River    -14.8       23.5   -0.63  0.53567    \nMangrove.systemTérminos Lagoon    -35.4       28.6   -1.23  0.23063    \nMangrove.systemCelestún Lagoon    147.0       21.9    6.72  1.2e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 37.5 on 21 degrees of freedom\nMultiple R-squared:  0.847, Adjusted R-squared:  0.825 \nF-statistic: 38.8 on 3 and 21 DF,  p-value: 9.48e-09\n\n#check model reliability\nshapiro.test(residuals(q2lm))\n\n\n    Shapiro-Wilk normality test\n\ndata:  residuals(q2lm)\nW = 0.9, p-value = 0.2\n\n# get significance\nq2_lm_means &lt;- emmeans(q2lm, pairwise ~ Mangrove.system)\ncld_results &lt;- cld(object = q2_lm_means$emmeans, Letters = letters)\n\n# Convert to data frame\nq2_emmeans_df &lt;- as.data.frame(cld_results)\nq2_emmeans_df\n\n Mangrove.system emmean   SE df lower.CL upper.CL .group\n Términos Lagoon   51.2 21.6 21      6.1     96.2  a    \n San Pedro River   71.7 14.2 21     42.3    101.2  a    \n Fossil Lagoon     86.5 18.8 21     47.5    125.5  a    \n Celestún Lagoon  233.5 11.3 21    210.0    257.0   b   \n\nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 4 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n\n\n\n# boxplot\nq2plot &lt;- ggplot(metadata_with_hill, aes(x = Mangrove.system, y = q2, fill = Mangrove.system)) +\n  geom_boxplot() +\n  #geom_jitter(aes(fill = Mangrove.system), width = 0.1, alpha = 0.4) +\n  geom_text(data = q2_emmeans_df, aes(y = emmean, label = .group), vjust = -5,\n            color = \"black\", fontface = \"bold\", position = position_dodge(0.9)) +\n  labs(title = \"q2 = Inv Simpson\", y = NULL, x = NULL,\n  caption = \"letters by lm emmeans\") +\n  theme_classic() + scale_fill_manual(values = loc_colors) +\n  theme(legend.position = \"none\")\n\nCombine plots\n\n#Combine alpha diversity plots\n# library(ggplot2)\n# library(cowplot)\n\nytitle &lt;- ggdraw() + draw_label(\"Effective number of ASVs\",\n                                angle = 90, size = 14 )\nq012plot &lt;- plot_grid(q0plot, q1plot, q2plot,\n                      labels = c(\"A)\", \"\", \"\"), ncol = 1)\nq012y_plot &lt;- plot_grid(ytitle, q012plot, ncol = 2, rel_widths = c(0.05, 1))\n\n# show\nq012y_plot\n\n\n\n\n\n\n# save\nggsave(\"Figures/SurfaceComparison/alphadiv_per_loc.pdf\",\n       q012y_plot, width = 6.3, height = 9.9)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Alpha diversity"
    ]
  },
  {
    "objectID": "02.1.AlphaDiversity.html#save-rds-alpha-diversity-plot",
    "href": "02.1.AlphaDiversity.html#save-rds-alpha-diversity-plot",
    "title": "Alpha diversity",
    "section": "Save rds alpha diversity plot",
    "text": "Save rds alpha diversity plot\n\nsaveRDS(q012y_plot, \"rds/compare_mangroves/alpha_diversity_surface_plot.rds\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Alpha diversity"
    ]
  },
  {
    "objectID": "02.5.Fig2.InteriorCoastalCompare.html",
    "href": "02.5.Fig2.InteriorCoastalCompare.html",
    "title": "Figure Interior and Coastal mangroves compare",
    "section": "",
    "text": "library(ggplot2)\nlibrary(cowplot)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Figure Interior and Coastal mangroves compare"
    ]
  },
  {
    "objectID": "02.5.Fig2.InteriorCoastalCompare.html#load-figures",
    "href": "02.5.Fig2.InteriorCoastalCompare.html#load-figures",
    "title": "Figure Interior and Coastal mangroves compare",
    "section": "Load figures",
    "text": "Load figures\n\nalpha &lt;- readRDS(\"rds/compare_mangroves/alpha_diversity_surface_plot.rds\")\n\nbeta &lt;- readRDS(\"rds/compare_mangroves/beta-diversity-surface-plot.rds\")\n\ncore &lt;- readRDS(\"rds/compare_mangroves/upset_surface_plot.rds\")\n\ndabar &lt;- readRDS(\"rds/compare_mangroves/DA_barplot_surface.rds\")\n\ndahm &lt;- readRDS(\"rds/compare_mangroves/DA_heatmap_surface.rds\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Figure Interior and Coastal mangroves compare"
    ]
  },
  {
    "objectID": "02.5.Fig2.InteriorCoastalCompare.html#combine-plots",
    "href": "02.5.Fig2.InteriorCoastalCompare.html#combine-plots",
    "title": "Figure Interior and Coastal mangroves compare",
    "section": "Combine plots",
    "text": "Combine plots\n\nbeta_core &lt;- plot_grid(beta, core, labels = c(\"B\", \"D)\"),\n                        label_fontface = \"bold\",\n                        ncol = 1, rel_heights = c(0.8, 1))\nbeta_core_da &lt;- plot_grid(beta_core, dahm, labels = c(\"\", \"C)\"),\n                        label_fontface = \"bold\",\n                        ncol = 2, rel_widths = c(1, 0.9))\nalpha_beta_core_da_2 &lt;- plot_grid(alpha, beta_core_da,\n                        ncol = 2, rel_widths = c(0.35, 1))\nalpha_beta_core_da_2\n\n\n\n\n\n\n\n\nggsave(\"Figures/SurfaceComparison/Fig2.SurfaceComparison_2.pdf\",\n       alpha_beta_core_da_2, width = 19, height = 12)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Figure Interior and Coastal mangroves compare"
    ]
  },
  {
    "objectID": "00.Presentation.html",
    "href": "00.Presentation.html",
    "title": "Unraveling microbial diversity from a fossil lagoon with an inland mangrove forest",
    "section": "",
    "text": "Website of microbial diversity analysis of the paper …\n\n\n\nMangroves play a crucial role in ecological services like hurricane protection, carbon storage, and biodiversity support by harboring essential microbial communities for nutrient recycling and biogeochemical cycling. The microbial diversity of inland mangroves, particularly the relict mangroves of the San Pedro River from the last interglacial period, remains understudied. The study of these surviving mangrove systems offers insights into microbial dynamics and the identification of resilient microbiota with potential applications in mangrove restoration efforts. By exploring similarities and differences between coastal and inland mangroves, as well as degraded coastal mangroves, we aim to understand the unique qualities that make inland mangroves distinct while also identifying common elements shared by all mangrove ecosystems.\nIn this work we studied the microbial diversity associated with Rhizophora mangle of inland and coastal mangroves distributed on the Yucatan platform. Inland mangroves, distributed along the San Pedro Martir river, are 170 km away from the nearest estuary. Samples were taken from Laguna El Cacahuate (Fossil Lagoon), in the upper part of the river, near Guatemala, and from the Miguelito Dike and Reforma Waterfalls in the lower part of the river, in the state of Tabasco. While for coastal mangroves, public data were taken from isolated sediments in the Términos Lagoon and the Celestún Lagoon.",
    "crumbs": [
      "Presentation"
    ]
  },
  {
    "objectID": "02.4.DifferentialAbundance.html",
    "href": "02.4.DifferentialAbundance.html",
    "title": "Differential Abundance",
    "section": "",
    "text": "# load libraries\nlibrary(phyloseq)\nlibrary(dplyr)\nlibrary(ANCOMBC)\nlibrary(tidyverse)\nlibrary(DT)\noptions(DT.options = list(\n  initComplete = JS(\"function(settings, json) {\",\n                    \"$(this.api().table().header()).css({'background-color':\n  '#000', 'color': '#fff'});\",\"}\")))\n\n\n#load data\nphyseq_qiime3 &lt;- readRDS(\"rds/compare_mangroves/physeq_qiime3.rds\")\n\n\n# Rename mangrove system columna\ncolnames(sample_data(physeq_qiime3))[colnames(sample_data(physeq_qiime3)) == \"Mangrove system\"] &lt;- \"Mangrove_system\"\n\n# Convert Mangrove_system to factor\nsample_data(physeq_qiime3)$Mangrove_system &lt;- as.factor(sample_data(physeq_qiime3)$Mangrove_system)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Differential Abundance"
    ]
  },
  {
    "objectID": "02.4.DifferentialAbundance.html#load-libraries-and-data",
    "href": "02.4.DifferentialAbundance.html#load-libraries-and-data",
    "title": "Differential Abundance",
    "section": "",
    "text": "# load libraries\nlibrary(phyloseq)\nlibrary(dplyr)\nlibrary(ANCOMBC)\nlibrary(tidyverse)\nlibrary(DT)\noptions(DT.options = list(\n  initComplete = JS(\"function(settings, json) {\",\n                    \"$(this.api().table().header()).css({'background-color':\n  '#000', 'color': '#fff'});\",\"}\")))\n\n\n#load data\nphyseq_qiime3 &lt;- readRDS(\"rds/compare_mangroves/physeq_qiime3.rds\")\n\n\n# Rename mangrove system columna\ncolnames(sample_data(physeq_qiime3))[colnames(sample_data(physeq_qiime3)) == \"Mangrove system\"] &lt;- \"Mangrove_system\"\n\n# Convert Mangrove_system to factor\nsample_data(physeq_qiime3)$Mangrove_system &lt;- as.factor(sample_data(physeq_qiime3)$Mangrove_system)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Differential Abundance"
    ]
  },
  {
    "objectID": "02.4.DifferentialAbundance.html#differential-abundance-ancombc2",
    "href": "02.4.DifferentialAbundance.html#differential-abundance-ancombc2",
    "title": "Differential Abundance",
    "section": "01. Differential abundance ANCOMBC2",
    "text": "01. Differential abundance ANCOMBC2\n01.1 Prepare data\n\n# phyloseq to TreeSummarizedExperiment\ntse &lt;- mia::convertFromPhyloseq(physeq_qiime3)\n\n\n#To manually change the reference level, not alphabetic order\ntse$Mangrove_system = factor(tse$Mangrove_system, levels = c(\"Fossil Lagoon\", \"San Pedro River\", \"Términos Lagoon\", \"Celestún Lagoon\"))\n\n\n#conver to factor using letter levels\ntse$Mangrove_system &lt;- factor(recode\n                              (as.character(tse$Mangrove_system),\n                                    `Fossil Lagoon` = \"FL\",\n                                    `San Pedro River` = \"SPR\",\n                                    `Términos Lagoon` = \"TL\",\n                                    `Celestún Lagoon` = \"CL\",\n                                    .missing = \"unknown\"),\n                             levels = c(\"FL\", \"SPR\", \"TL\", \"CL\"))\n\n\n# contrast matrix\ncontrast_matrices &lt;- list(\n  matrix(c(1, -1, 0,\n           0, 1, -1,\n           0, 0, 1),\n         nrow = 3, byrow = TRUE),\n  matrix(c(1, 0, -1,\n           0, 1, -1,\n           0, 0, 1),\n         nrow = 3, byrow = TRUE),\n  matrix(c(1, 0, 0,\n           0, 1, -1,\n           0, 0, 1),\n         nrow = 3, byrow = TRUE),\n  matrix(c(1, -1, 0,\n           0, 1, 0,\n           0, 0, 1),\n         nrow = 3, byrow = TRUE))\n\n# nodes\nnodes &lt;- list(1, 1, 1, 1)\n\n01.2 Run ANCOM-BC2\n\n# ANCOMBC2\noutput &lt;- ancombc2(\n  data = tse,\n  assay_name = \"counts\",\n  tax_level = \"Phylum\",\n  fix_formula = \"Mangrove_system\",\n  rand_formula = NULL,\n  p_adj_method = \"BH\",\n  pseudo_sens = TRUE,\n  prv_cut = 0.10,\n  lib_cut = 1000,\n  s0_perc = 0.05,\n  group = \"Mangrove_system\",\n  struc_zero = TRUE,\n  neg_lb = TRUE,\n  alpha = 0.05,\n  n_cl = 2,\n  verbose = TRUE,\n  global = TRUE,\n  pairwise = TRUE,\n  dunnet = TRUE,\n  trend = TRUE,\n  iter_control = list(tol = 1e-2, max_iter = 20, verbose = TRUE),\n  em_control = list(tol = 1e-5, max_iter = 100),\n  lme_control = lme4::lmerControl(),\n  mdfdr_control = list(fwer_ctrl_method = \"BH\", B = 100),\n  trend_control = list(\n    contrast = contrast_matrices,\n    node = nodes,\n    solver = \"ECOS\",\n    B = 100\n  )\n)\n\nChecking the input data type ...\n\n\nThe input data is of type: TreeSummarizedExperiment\n\n\nPASS\n\n\nChecking the sample metadata ...\n\n\nThe specified variables in the formula: Mangrove_system\n\n\nThe available variables in the sample metadata: SampleID, BioSample, ID, SRA, SampleName, Collection_date, depth, site, elevation, Broad_scale_environmental_context, Local_scale_environmental_context, Environmental_medium, Latitude_and_Longitude, Geographic.Location, Study_zone, Ecological_type, Parametros, Temperatura, Salinidad, pH, Redox.mV, S.2, SO4, season, filter, Mangrove_system, Mangrove_type\n\n\nPASS\n\n\nChecking other arguments ...\n\n\nThe number of groups of interest is: 4\n\n\nThe sample size per group is: FL = 4, SPR = 7, TL = 3, CL = 11\n\n\nWarning: Small sample size detected for the following group(s): \nFL, TL\nVariance estimation would be unstable when the sample size is &lt; 5 per group\n\n\nPASS\n\n\nObtaining initial estimates ...\n\n\nML iteration = 1, epsilon = 1.1\n\n\nML iteration = 2, epsilon = 7.1\n\n\nML iteration = 3, epsilon = 0.92\n\n\nML iteration = 4, epsilon = 0.31\n\n\nML iteration = 5, epsilon = 0.19\n\n\nML iteration = 6, epsilon = 0.13\n\n\nML iteration = 7, epsilon = 0.083\n\n\nML iteration = 8, epsilon = 0.055\n\n\nML iteration = 9, epsilon = 0.036\n\n\nML iteration = 10, epsilon = 0.024\n\n\nML iteration = 11, epsilon = 0.016\n\n\nML iteration = 12, epsilon = 0.011\n\n\nML iteration = 13, epsilon = 0.007\n\n\nEstimating sample-specific biases ...\n\n\nConducting sensitivity analysis for pseudo-count addition to 0s ...\nFor taxa that are significant but do not pass the sensitivity analysis,\nplease flag them and proceed with caution, as they are likely false positives.\nFor detailed instructions on performing sensitivity analysis,\nplease refer to the package vignette.\n\n\nANCOM-BC2 primary results ...\n\n\nANCOM-BC2 global test ...\n\n\nANCOM-BC2 multiple pairwise comparisons ...\n\n\nANCOM-BC2 multiple pairwise comparisons against the reference group ...\n\n\nANCOM-BC2 pattern analysis ...\n\n\n\n#See results\nres_pair_Mangrove_system &lt;- output$res_pair\n\nhead(res_pair_Mangrove_system)\n\n             taxon lfc_Mangrove_systemSPR lfc_Mangrove_systemTL\n1  Acidobacteriota               -0.26768                 -3.39\n2 Actinobacteriota               -0.23213                 -3.71\n3  Asgardarchaeota                0.26584                 -3.47\n4     Bacteroidota               -0.48731                 -4.52\n5    Calditrichota               -0.16945                 -2.37\n6 Campilobacterota                0.00556                 -2.60\n  lfc_Mangrove_systemCL lfc_Mangrove_systemTL_Mangrove_systemSPR\n1                -0.490                                    -3.13\n2                -0.626                                    -3.47\n3                -0.589                                    -3.74\n4                -0.942                                    -4.03\n5                -0.264                                    -2.20\n6                -1.794                                    -2.61\n  lfc_Mangrove_systemCL_Mangrove_systemSPR\n1                                  -0.2225\n2                                  -0.3937\n3                                  -0.8550\n4                                  -0.4543\n5                                  -0.0946\n6                                  -1.7995\n  lfc_Mangrove_systemCL_Mangrove_systemTL se_Mangrove_systemSPR\n1                                   2.904                 0.158\n2                                   3.080                 0.133\n3                                   2.882                 0.311\n4                                   3.580                 0.139\n5                                   2.110                 0.223\n6                                   0.806                 0.370\n  se_Mangrove_systemTL se_Mangrove_systemCL\n1                0.268                0.166\n2                0.898                0.195\n3                0.380                0.434\n4                0.921                0.209\n5                0.283                0.245\n6                0.449                0.469\n  se_Mangrove_systemTL_Mangrove_systemSPR\n1                                   0.292\n2                                   0.903\n3                                   0.298\n4                                   0.924\n5                                   0.295\n6                                   0.323\n  se_Mangrove_systemCL_Mangrove_systemSPR\n1                                   0.203\n2                                   0.217\n3                                   0.405\n4                                   0.220\n5                                   0.258\n6                                   0.431\n  se_Mangrove_systemCL_Mangrove_systemTL W_Mangrove_systemSPR\n1                                  0.297               -1.699\n2                                  0.914               -1.743\n3                                  0.435                0.856\n4                                  0.937               -3.500\n5                                  0.311               -0.759\n6                                  0.452                0.015\n  W_Mangrove_systemTL W_Mangrove_systemCL\n1              -12.68               -2.96\n2               -4.13               -3.20\n3               -9.13               -1.36\n4               -4.91               -4.50\n5               -8.39               -1.08\n6               -5.80               -3.82\n  W_Mangrove_systemTL_Mangrove_systemSPR W_Mangrove_systemCL_Mangrove_systemSPR\n1                                 -10.69                                 -1.094\n2                                  -3.85                                 -1.812\n3                                 -12.56                                 -2.112\n4                                  -4.37                                 -2.065\n5                                  -7.48                                 -0.366\n6                                  -8.07                                 -4.179\n  W_Mangrove_systemCL_Mangrove_systemTL p_Mangrove_systemSPR\n1                                  9.78              0.10412\n2                                  3.37              0.09592\n3                                  6.62              0.40222\n4                                  3.82              0.00213\n5                                  6.78              0.45646\n6                                  1.78              0.98818\n  p_Mangrove_systemTL p_Mangrove_systemCL\n1            2.61e-11            0.007550\n2            4.81e-04            0.004254\n3            1.42e-08            0.189976\n4            7.44e-05            0.000196\n5            3.81e-08            0.293187\n6            1.39e-05            0.001144\n  p_Mangrove_systemTL_Mangrove_systemSPR p_Mangrove_systemCL_Mangrove_systemSPR\n1                               5.93e-10                               0.286427\n2                               9.40e-04                               0.084249\n3                               6.07e-11                               0.047481\n4                               2.70e-04                               0.051516\n5                               2.37e-07                               0.717960\n6                               1.47e-07                               0.000509\n  p_Mangrove_systemCL_Mangrove_systemTL q_Mangrove_systemSPR\n1                              2.86e-09              0.13119\n2                              2.91e-03              0.10071\n3                              1.89e-06              0.42233\n4                              9.95e-04              0.00269\n5                              1.06e-06              0.57514\n6                              9.06e-02              1.00000\n  q_Mangrove_systemTL q_Mangrove_systemCL\n1            1.65e-10            0.011892\n2            2.96e-03            0.006700\n3            4.46e-08            0.239369\n4            4.69e-04            0.000567\n5            2.40e-07            0.461769\n6            4.37e-05            0.001801\n  q_Mangrove_systemTL_Mangrove_systemSPR q_Mangrove_systemCL_Mangrove_systemSPR\n1                               1.87e-09                                0.30075\n2                               2.96e-03                                0.10071\n3                               3.82e-10                                0.07478\n4                               5.67e-04                                0.05409\n5                               7.48e-07                                0.75386\n6                               9.26e-07                                0.00107\n  q_Mangrove_systemCL_Mangrove_systemTL diff_Mangrove_systemSPR\n1                              6.01e-09                   FALSE\n2                              6.11e-03                   FALSE\n3                              3.97e-06                   FALSE\n4                              1.57e-03                    TRUE\n5                              2.22e-06                   FALSE\n6                              1.14e-01                   FALSE\n  diff_Mangrove_systemTL diff_Mangrove_systemCL\n1                   TRUE                   TRUE\n2                   TRUE                   TRUE\n3                   TRUE                  FALSE\n4                   TRUE                   TRUE\n5                   TRUE                  FALSE\n6                   TRUE                   TRUE\n  diff_Mangrove_systemTL_Mangrove_systemSPR\n1                                      TRUE\n2                                      TRUE\n3                                      TRUE\n4                                      TRUE\n5                                      TRUE\n6                                      TRUE\n  diff_Mangrove_systemCL_Mangrove_systemSPR\n1                                     FALSE\n2                                     FALSE\n3                                     FALSE\n4                                     FALSE\n5                                     FALSE\n6                                      TRUE\n  diff_Mangrove_systemCL_Mangrove_systemTL passed_ss_Mangrove_systemSPR\n1                                     TRUE                         TRUE\n2                                     TRUE                         TRUE\n3                                     TRUE                         TRUE\n4                                     TRUE                        FALSE\n5                                     TRUE                         TRUE\n6                                    FALSE                         TRUE\n  passed_ss_Mangrove_systemTL passed_ss_Mangrove_systemCL\n1                        TRUE                        TRUE\n2                        TRUE                       FALSE\n3                        TRUE                        TRUE\n4                        TRUE                        TRUE\n5                        TRUE                        TRUE\n6                        TRUE                       FALSE\n  passed_ss_Mangrove_systemTL_Mangrove_systemSPR\n1                                           TRUE\n2                                           TRUE\n3                                           TRUE\n4                                           TRUE\n5                                           TRUE\n6                                           TRUE\n  passed_ss_Mangrove_systemCL_Mangrove_systemSPR\n1                                           TRUE\n2                                           TRUE\n3                                          FALSE\n4                                           TRUE\n5                                           TRUE\n6                                           TRUE\n  passed_ss_Mangrove_systemCL_Mangrove_systemTL\n1                                          TRUE\n2                                          TRUE\n3                                          TRUE\n4                                          TRUE\n5                                          TRUE\n6                                          TRUE",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Differential Abundance"
    ]
  },
  {
    "objectID": "02.4.DifferentialAbundance.html#get-differential-data",
    "href": "02.4.DifferentialAbundance.html#get-differential-data",
    "title": "Differential Abundance",
    "section": "02. Get differential data",
    "text": "02. Get differential data\n\n# Create dataframe df_fig_pair1 to log-fold change (LFC) values\ndf_fig_pair1_Mangrove_system &lt;- res_pair_Mangrove_system %&gt;%\n  dplyr::filter(`diff_Mangrove_systemSPR` == 1 |\n                `diff_Mangrove_systemTL` == 1 |\n                `diff_Mangrove_systemCL` == 1 |\n                `diff_Mangrove_systemTL_Mangrove_systemSPR` == 1 |\n                `diff_Mangrove_systemCL_Mangrove_systemSPR` == 1 |\n                `diff_Mangrove_systemCL_Mangrove_systemTL` == 1) %&gt;%\n  dplyr::mutate(lfc1 = ifelse(`diff_Mangrove_systemSPR` == 1, \n                      round(`lfc_Mangrove_systemSPR`, 2), NA),\n                lfc2 = ifelse(`diff_Mangrove_systemTL` == 1, \n                      round(`lfc_Mangrove_systemTL`, 2), NA),\n                lfc3 = ifelse(`diff_Mangrove_systemCL` == 1, \n                      round(`lfc_Mangrove_systemCL`, 2), NA),\n                lfc4 = ifelse(`diff_Mangrove_systemTL_Mangrove_systemSPR` == 1, \n                      round(`lfc_Mangrove_systemTL_Mangrove_systemSPR`, 2), NA),\n                lfc5 = ifelse(`diff_Mangrove_systemCL_Mangrove_systemSPR` == 1, \n                      round(`lfc_Mangrove_systemCL_Mangrove_systemSPR`, 2), NA),\n                lfc6 = ifelse(`diff_Mangrove_systemCL_Mangrove_systemTL` == 1, \n                      round(`lfc_Mangrove_systemCL_Mangrove_systemTL`, 2), NA),\n                ) %&gt;% tidyr::pivot_longer(cols = lfc1:lfc6, names_to = \"group\", \n                          values_to = \"value\") %&gt;% dplyr::arrange(taxon)\n\n\n# Create dataframe df_fig_pair2 to significant values\ndf_fig_pair2_Mangrove_system &lt;- res_pair_Mangrove_system %&gt;%\n  dplyr::filter(`diff_Mangrove_systemSPR` == 1 |\n                `diff_Mangrove_systemTL` == 1 |\n                `diff_Mangrove_systemCL` == 1 |\n                `diff_Mangrove_systemTL_Mangrove_systemSPR` == 1 |\n                `diff_Mangrove_systemCL_Mangrove_systemSPR` == 1 |\n                `diff_Mangrove_systemCL_Mangrove_systemTL` == 1) %&gt;%\n   dplyr::mutate(lfc1 = ifelse(`passed_ss_Mangrove_systemSPR` == 1 & \n                `diff_Mangrove_systemSPR` == 1, \"darkblue\", \"black\"),\n                lfc2 = ifelse(`passed_ss_Mangrove_systemTL` == 1 & \n                `diff_Mangrove_systemTL` == 1, \"darkblue\", \"black\"),\n                lfc3 = ifelse(`passed_ss_Mangrove_systemCL` == 1 &\n                `diff_Mangrove_systemCL` == 1, \"darkblue\", \"black\"),\n                lfc4 = ifelse(`passed_ss_Mangrove_systemTL_Mangrove_systemSPR` == 1 &\n                `diff_Mangrove_systemTL_Mangrove_systemSPR` == 1, \"darkblue\", \"black\"),\n                lfc5 = ifelse(`passed_ss_Mangrove_systemCL_Mangrove_systemSPR` == 1 &\n                `diff_Mangrove_systemCL_Mangrove_systemSPR` == 1, \"darkblue\", \"black\"),\n                lfc6 = ifelse(`passed_ss_Mangrove_systemCL_Mangrove_systemTL` == 1 &\n                `diff_Mangrove_systemCL_Mangrove_systemTL` == 1, \"darkblue\", \"black\")) %&gt;% \n  tidyr::pivot_longer(cols = lfc1:lfc6, names_to = \"group\", values_to = \"color\") %&gt;% dplyr::arrange(taxon)\n\n\n# Combine dataframes df_fig_pair1 and df_fig_pair2\ndf_fig_pair_Mangrove_system &lt;- df_fig_pair1_Mangrove_system %&gt;%\n  dplyr::left_join(df_fig_pair2_Mangrove_system, by = c(\"taxon\", \"group\"))\n\n# Rename groups\ndf_fig_pair_Mangrove_system$group &lt;- recode(df_fig_pair_Mangrove_system$group,\n                                     `lfc1` = \"SPR vs FL\",\n                                     `lfc2` = \"TL vs FL\",\n                                     `lfc3` = \"CL vs FL\",\n                                     `lfc4` = \"TL vs SPR\",\n                                     `lfc5` = \"CL vs SPR\",\n                                     `lfc6` = \"CL vs TL\")\n\ndf_fig_pair_Mangrove_system$group &lt;- factor(df_fig_pair_Mangrove_system$group,\n                                     levels = c(\"SPR vs FL\",\n                                                \"TL vs FL\",\n                                                \"CL vs FL\",\n                                                \"TL vs SPR\",\n                                                \"CL vs SPR\",\n                                                \"CL vs TL\"))\n\n# Filter comparisons without significant values\ndf_fig_pair_Mangrove_system &lt;- df_fig_pair_Mangrove_system %&gt;%\n  group_by(group) %&gt;%\n  filter(any(!is.na(value))) %&gt;%\n  ungroup()\n\n# Calculate limits\nlo &lt;- floor(min(df_fig_pair_Mangrove_system$value, na.rm = TRUE))\nup &lt;- ceiling(max(df_fig_pair_Mangrove_system$value, na.rm = TRUE))\nmid &lt;- (lo + up) / 2",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Differential Abundance"
    ]
  },
  {
    "objectID": "02.4.DifferentialAbundance.html#plot",
    "href": "02.4.DifferentialAbundance.html#plot",
    "title": "Differential Abundance",
    "section": "03. Plot",
    "text": "03. Plot\n\n# heatmap\nheatmap_fig_pair_Mangrove_system &lt;- df_fig_pair_Mangrove_system %&gt;%\n  ggplot(aes(x = group, y = taxon, fill = value)) +\n  geom_tile(color = \"gray50\") +\n  scale_fill_gradient2(low = \"#37485FFF\", high = \"#907c9BFf\", mid = \"#cad8DCFF\", #a71a50\n                       na.value = \"white\", midpoint = mid, limit = c(lo, up),\n                       name = \"LFC\") +\n  geom_text(aes(label = round(value, 2), color = color), size = 3.5, na.rm = TRUE) +\n  scale_color_identity(guide = FALSE) +\n  labs(x = NULL, y = NULL, title = \"Differential abundance between mangrove system\") +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5, size = 13),\n        axis.text.y = element_text(size = 12, color = \"black\"),\n        axis.text.x = element_text(size = 9, angle = 0, \n                                   hjust = 0.5, color = \"black\"))\n\n# show\nprint(heatmap_fig_pair_Mangrove_system)\n\nWarning: The `guide` argument in `scale_*()` cannot be `FALSE`. This was deprecated in\nggplot2 3.3.4.\nℹ Please use \"none\" instead.\n\n\n\n\n\n\n\n\n\n# DA barplot\nlibrary(paletteer)\nda_barplot &lt;- df_fig_pair_Mangrove_system %&gt;%\n  ggplot(aes(x = taxon, y = value, fill = group, label = round(value, 2))) +\n  geom_bar(stat = \"identity\", position = \"dodge\") +\n  scale_fill_paletteer_d(\"ggsci::blue_grey_material\") + #\"rcartocolor::Purp\"\n  # scale_fill_manual(values = c(\"SPR vs FL\" = \"orange\",\n  #                              \"TL vs FL\" = \"#a71b40\",\n  #                              \"CL vs FL\" = \"yellow3\",\n  #                              \"TL vs SPR\" = \"gray50\",\n  #                              \"CL vs SPR\" = \"#af4b91\",\n  #                              \"CL vs TL\" = \"#466eb4\")) +\n  labs(title = \"Differential Abundance by Mangrove system\",\n       x = \"Phylum\",\n       y = \"Log-Fold Change\",\n       fill = \"Comparison\") +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10),\n        axis.text.y = element_text(size = 8),\n        plot.title = element_text(size = 12),\n        axis.title.x = element_text(size = 9),              \n        axis.title.y = element_text(size = 9),            \n        legend.title = element_text(size = 9))\n\n#show\nda_barplot",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Differential Abundance"
    ]
  },
  {
    "objectID": "02.4.DifferentialAbundance.html#save-rds-plot",
    "href": "02.4.DifferentialAbundance.html#save-rds-plot",
    "title": "Differential Abundance",
    "section": "Save rds plot",
    "text": "Save rds plot\n\nsaveRDS(heatmap_fig_pair_Mangrove_system, \"rds/compare_mangroves/DA_heatmap_surface.rds\")\nsaveRDS(da_barplot, \"rds/compare_mangroves/DA_barplot_surface.rds\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Differential Abundance"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html",
    "href": "02.3.Coremicrobiome.html",
    "title": "Core microbiome",
    "section": "",
    "text": "# load libraries\nlibrary(phyloseq)\nlibrary(dplyr)\nlibrary(UpSetR)\nlibrary(ggplot2)\nlibrary(ggalluvial)\n\n\n#load data\nphyseq_qiime3 &lt;- readRDS(\"rds/compare_mangroves/physeq_qiime3.rds\")\n\n\n# Rename mangrove system columna\ncolnames(sample_data(physeq_qiime3))[colnames(sample_data(physeq_qiime3)) == \"Mangrove system\"] &lt;- \"Mangrove_system\"\n\n# Convert Mangrove_system to factor\nsample_data(physeq_qiime3)$Mangrove_system &lt;- as.factor(sample_data(physeq_qiime3)$Mangrove_system)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#load-libraries-and-prepare-data",
    "href": "02.3.Coremicrobiome.html#load-libraries-and-prepare-data",
    "title": "Core microbiome",
    "section": "",
    "text": "# load libraries\nlibrary(phyloseq)\nlibrary(dplyr)\nlibrary(UpSetR)\nlibrary(ggplot2)\nlibrary(ggalluvial)\n\n\n#load data\nphyseq_qiime3 &lt;- readRDS(\"rds/compare_mangroves/physeq_qiime3.rds\")\n\n\n# Rename mangrove system columna\ncolnames(sample_data(physeq_qiime3))[colnames(sample_data(physeq_qiime3)) == \"Mangrove system\"] &lt;- \"Mangrove_system\"\n\n# Convert Mangrove_system to factor\nsample_data(physeq_qiime3)$Mangrove_system &lt;- as.factor(sample_data(physeq_qiime3)$Mangrove_system)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#calculate-core",
    "href": "02.3.Coremicrobiome.html#calculate-core",
    "title": "Core microbiome",
    "section": "01. Calculate core",
    "text": "01. Calculate core\n\n# Prevalence threshold\nprevalence_threshold &lt;- 0.8\n\n# Storage ASVs core list\ncore_list &lt;- list()\nlocations &lt;- levels(sample_data(physeq_qiime3)$Mangrove_system)\n\n# Calculate core\nfor (loc in locations) {\n  # Filter samples by mangrove system\n  physeq_loc &lt;- prune_samples(sample_data(physeq_qiime3)$Mangrove_system == loc, physeq_qiime3)\n  n_samples_loc &lt;- nsamples(physeq_loc)\n\n  # Extract OTU table\n  otu &lt;- as(otu_table(physeq_loc), \"matrix\")\n\n  # Calc prevalence\n  prevalence &lt;- rowSums(otu &gt; 0) / n_samples_loc\n\n  # Identify ASVs with prevalence &gt;= umbral\n  core_taxa &lt;- names(prevalence)[prevalence &gt;= prevalence_threshold]\n\n  # Guardar en la lista\n  core_list[[loc]] &lt;- core_taxa\n}\n\n# Show ASVs core by mangrove system\nprint(lapply(core_list, length))\n\n$`Celestún Lagoon`\n[1] 577\n\n$`Fossil Lagoon`\n[1] 745\n\n$`San Pedro River`\n[1] 781\n\n$`Términos Lagoon`\n[1] 16\n\n# checkpoint,if empty try threshold = 1\nif (all(sapply(core_list, length) == 0)) {\n  cat(\"Try prevalence = 1...\\n\")\n  prevalence_threshold &lt;- 1.0\n  core_list &lt;- list()\n  for (loc in locations) {\n    physeq_loc &lt;- prune_samples(sample_data(physeq_qiime3)$Mangrove_system == loc, physeq_qiime3)\n    n_samples_loc &lt;- nsamples(physeq_loc)\n    otu &lt;- as(otu_table(physeq_loc), \"matrix\")\n    prevalence &lt;- rowSums(otu &gt; 0) / n_samples_loc\n    core_taxa &lt;- names(prevalence)[prevalence &gt;= prevalence_threshold]\n    core_list[[loc]] &lt;- core_taxa\n  }\n  print(lapply(core_list, length))\n}",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#extract-core-info",
    "href": "02.3.Coremicrobiome.html#extract-core-info",
    "title": "Core microbiome",
    "section": "02. Extract core info",
    "text": "02. Extract core info\n\n# Unique core ASV list\nall_core_asvs &lt;- unique(unlist(core_list))\n\n# Create matrix presence/absence\ncore_matrix &lt;- matrix(0, nrow = length(all_core_asvs), ncol = length(locations),\n                      dimnames = list(all_core_asvs, locations))\n\n# fill matrix: \nfor (loc in locations) {\n  core_matrix[core_list[[loc]], loc] &lt;- 1\n}\n\n# Convert to data frame to UpSetR\ncore_df &lt;- as.data.frame(core_matrix)\n\n# Create intersection list\nqueries_list &lt;- list()",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#plot-aesthetics",
    "href": "02.3.Coremicrobiome.html#plot-aesthetics",
    "title": "Core microbiome",
    "section": "03. plot aesthetics",
    "text": "03. plot aesthetics\n\n#library(UpSetR)\n# Fossil Lagoon\nqueries_list &lt;- append(queries_list, list(\n  list(query = intersects, params = list(\"Fossil Lagoon\"), color = \"#A7FCC1\",\n       active = TRUE, query.name = \"Fossil Lagoon\")\n))\n\n# San Pedro River\nqueries_list &lt;- append(queries_list, list(\n  list(query = intersects, params = list(\"San Pedro River\"), color = \"#26B170\",\n       active = TRUE, query.name = \"San Pedro River\")\n))\n\n# Terminos Lagoon\nqueries_list &lt;- append(queries_list, list(\n  list(query = intersects, params = list(\"Términos Lagoon\"), color = \"#329D9C\",\n       active = TRUE, query.name = \"Términos Lagoon\")\n))\n\n# Celestún\nqueries_list &lt;- append(queries_list, list(\n  list(query = intersects, params = list(\"Celestún Lagoon\"), color = \"#41E8D3\",\n       active = TRUE, query.name = \"Celestún Lagoon\")\n))\n\n# Core\nqueries_list &lt;- append(queries_list, list(\n  list(query = intersects, params = list(\"Fossil Lagoon\", \n                                         \"San Pedro River\",\n                                         \"Términos Lagoon\",\n                                         \"Celestún Lagoon\"),\n       color = \"#8D3CA3\", active = TRUE, query.name = \"Core\")))\n\n# Interior\nqueries_list &lt;- append(queries_list, list(\n  list(query = intersects, params = list(\"Fossil Lagoon\", \"San Pedro River\"),\n       color = \"#356E48\", active = TRUE, query.name = \"Interior\")\n))\n\n## Note: due to the fact that there were no unique asvs for coastal, it was not integrated in this selection.",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#upset-plot",
    "href": "02.3.Coremicrobiome.html#upset-plot",
    "title": "Core microbiome",
    "section": "04. UpSet plot",
    "text": "04. UpSet plot\n\n#library(UpSetR)\nupset_plot &lt;- upset(core_df,\n                    sets = colnames(core_df),\n                    order.by = \"freq\",\n                    mainbar.y.label = \"Shared ASVs\",\n                    sets.x.label = \"ASVs per Site\",\n                    text.scale = 1.5,\n                    point.size = 4,\n                    line.size = 1.5,\n                    query.legend = \"bottom\",\n                    sets.bar.color = \n                      c(\"#26B170\",\"#A7FCC1\",\"#41E8D3\",\"#329D9C\"),\n                    queries = queries_list)\n\n# show\nprint(upset_plot)\n\n\n\n\n\n\n\nsave plot\n\npdf(\"Figures/SurfaceComparison/core_upset.pdf\", width = 5.8, height = 4)\nupset_plot\ndev.off()\n\nquartz_off_screen \n                2",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#get-unique-and-core-asv-info",
    "href": "02.3.Coremicrobiome.html#get-unique-and-core-asv-info",
    "title": "Core microbiome",
    "section": "05. Get unique and core ASV info",
    "text": "05. Get unique and core ASV info\n\n### get unique ASVs per mangrove system\nunique_asvs &lt;- list()\nfor (loc in colnames(core_df)) {\n  unique_asvs[[loc]] &lt;- rownames(core_df)[rowSums(core_df == 1) == 1 & core_df[[loc]] == 1]\n  cat(loc, \": Unique ASVs:\", length(unique_asvs[[loc]]), \"\\n\")\n  print(head(unique_asvs[[loc]], 5))  # Show first 5\n}\n\nCelestún Lagoon : Unique ASVs: 186 \n[1] \"KU578729.1.1383\" \"JF344529.1.1525\" \"JN483938.1.1414\" \"HE804536.1.1436\"\n[5] \"DQ811792.1.1512\"\nFossil Lagoon : Unique ASVs: 270 \n[1] \"FN398053.1.1489\" \"FR667789.1.1446\" \"EU385876.1.1464\" \"EU487871.1.1472\"\n[5] \"JQ989640.1.1399\"\nSan Pedro River : Unique ASVs: 256 \n[1] \"KY618740.1.1206\" \"EU592483.1.1535\" \"LN567307.1.1331\" \"DQ363844.1.926\" \n[5] \"HM598151.1.1526\"\nTérminos Lagoon : Unique ASVs: 1 \n[1] \"EU487913.1.1482\"\n\n#unique_asvs\n\n\n# Verify taxonomy\nif (!is.null(tax_table(physeq_qiime3))) {\n  tax_table_df &lt;- as.data.frame(tax_table(physeq_qiime3))\n\n  # Get taxonomy function\n  get_taxonomy &lt;- function(asv_list) {\n    if (length(asv_list) &gt; 0) {\n      taxonomy &lt;- tax_table_df[asv_list, , drop = FALSE]\n      return(taxonomy)\n    } else {\n      return(NULL)\n    }\n  }\n\n  # Get taxonomy\n  taxonomy_unique &lt;- lapply(unique_asvs, get_taxonomy)\n\n  # show first 5  unique ASVs\n  for (loc in names(taxonomy_unique)) {\n    cat(\"\\nFirst unique ASVs taxonomy\", loc, \":\\n\")\n    if (!is.null(taxonomy_unique[[loc]])) {\n      print(head(taxonomy_unique[[loc]], 5))\n    } else {\n      cat(\"There are no unique ASV to\", loc, \"\\n\")\n    }\n  }\n} else {\n  cat(\"Please import taxonomy.\\n\")\n}\n\n\nFirst unique ASVs taxonomy Celestún Lagoon :\n                    Kingdom                       Phylum\nKU578729.1.1383 d__Bacteria            Verrucomicrobiota\nJF344529.1.1525 d__Bacteria                      Sva0485\nJN483938.1.1414 d__Bacteria                 Bacteroidota\nHE804536.1.1436 d__Bacteria             Actinobacteriota\nDQ811792.1.1512 d__Bacteria SAR324_clade(Marine_group_B)\n                                       Class                        Order\nKU578729.1.1383                  Omnitrophia                Omnitrophales\nJF344529.1.1525                      Sva0485                      Sva0485\nJN483938.1.1414                  Bacteroidia                 Cytophagales\nHE804536.1.1436               Coriobacteriia                        OPB41\nDQ811792.1.1512 SAR324_clade(Marine_group_B) SAR324_clade(Marine_group_B)\n                                      Family                        Genus\nKU578729.1.1383               Omnitrophaceae       Candidatus_Omnitrophus\nJF344529.1.1525                      Sva0485                      Sva0485\nJN483938.1.1414            Cyclobacteriaceae                   uncultured\nHE804536.1.1436                        OPB41                        OPB41\nDQ811792.1.1512 SAR324_clade(Marine_group_B) SAR324_clade(Marine_group_B)\n                         Species\nKU578729.1.1383             &lt;NA&gt;\nJF344529.1.1525             &lt;NA&gt;\nJN483938.1.1414             &lt;NA&gt;\nHE804536.1.1436             &lt;NA&gt;\nDQ811792.1.1512 uncultured_delta\n\nFirst unique ASVs taxonomy Fossil Lagoon :\n                    Kingdom           Phylum               Class\nFN398053.1.1489 d__Bacteria   Proteobacteria Gammaproteobacteria\nFR667789.1.1446 d__Bacteria   Proteobacteria Alphaproteobacteria\nEU385876.1.1464 d__Bacteria   Proteobacteria Gammaproteobacteria\nEU487871.1.1472 d__Bacteria      Chloroflexi     Dehalococcoidia\nJQ989640.1.1399  d__Archaea Thermoplasmatota      Thermoplasmata\n                                             Order\nFN398053.1.1489                    Cellvibrionales\nFR667789.1.1446                      Micropepsales\nEU385876.1.1464              UBA10353_marine_group\nEU487871.1.1472                       Napoli-4B-65\nJQ989640.1.1399 Marine_Benthic_Group_D_and_DHVEG-1\n                                            Family\nFN398053.1.1489                         Halieaceae\nFR667789.1.1446                     Micropepsaceae\nEU385876.1.1464              UBA10353_marine_group\nEU487871.1.1472                       Napoli-4B-65\nJQ989640.1.1399 Marine_Benthic_Group_D_and_DHVEG-1\n                                             Genus              Species\nFN398053.1.1489                               &lt;NA&gt;                 &lt;NA&gt;\nFR667789.1.1446                     Micropepsaceae uncultured_bacterium\nEU385876.1.1464              UBA10353_marine_group uncultured_bacterium\nEU487871.1.1472                       Napoli-4B-65 uncultured_bacterium\nJQ989640.1.1399 Marine_Benthic_Group_D_and_DHVEG-1  uncultured_archaeon\n\nFirst unique ASVs taxonomy San Pedro River :\n                    Kingdom           Phylum               Class\nKY618740.1.1206 d__Bacteria       Firmicutes             Bacilli\nEU592483.1.1535 d__Bacteria Desulfobacterota     Desulfobacteria\nLN567307.1.1331 d__Bacteria   Proteobacteria Alphaproteobacteria\nDQ363844.1.926   d__Archaea Thermoplasmatota      Thermoplasmata\nHM598151.1.1526 d__Bacteria Desulfobacterota     Desulfobacteria\n                             Order              Family          Genus\nKY618740.1.1206         Bacillales         Bacillaceae       Bacillus\nEU592483.1.1535 Desulfatiglandales Desulfatiglandaceae Desulfatiglans\nLN567307.1.1331        Rhizobiales  Methyloligellaceae     uncultured\nDQ363844.1.926          uncultured          uncultured     uncultured\nHM598151.1.1526 Desulfatiglandales Desulfatiglandaceae Desulfatiglans\n                             Species\nKY618740.1.1206                 &lt;NA&gt;\nEU592483.1.1535 uncultured_bacterium\nLN567307.1.1331                 &lt;NA&gt;\nDQ363844.1.926   uncultured_archaeon\nHM598151.1.1526                 &lt;NA&gt;\n\nFirst unique ASVs taxonomy Términos Lagoon :\n                    Kingdom      Phylum        Class          Order\nEU487913.1.1482 d__Bacteria Chloroflexi Anaerolineae Anaerolineales\n                         Family      Genus Species\nEU487913.1.1482 Anaerolineaceae uncultured    &lt;NA&gt;\n\n# Confirm the total number of unique ASVs\nlapply(taxonomy_unique, function(x) if (!is.null(x)) nrow(x) else 0)\n\n$`Celestún Lagoon`\n[1] 186\n\n$`Fossil Lagoon`\n[1] 270\n\n$`San Pedro River`\n[1] 256\n\n$`Términos Lagoon`\n[1] 1\n\n\nGet taxonomy\nPhylum level\n\n# Create a list to store unique asv to Phylum level\nphylum_unique &lt;- list()\n\n# Iterate on each Mangrove system\nfor (loc in names(taxonomy_unique)) {\n  if (!is.null(taxonomy_unique[[loc]])) {\n    # Extract taxonomy phylum\n    tax_df &lt;- taxonomy_unique[[loc]]\n    if (\"Phylum\" %in% colnames(tax_df)) {\n      phylum &lt;- tax_df$Phylum\n      phylum &lt;- phylum[!is.na(phylum)]  # Exclude NA\n      phylum_unique[[loc]] &lt;- unique(phylum)\n    } else {\n      cat(\"Phylum is not available to\", loc, \"\\n\")\n      phylum_unique[[loc]] &lt;- character(0)\n    }\n  } else {\n    phylum_unique[[loc]] &lt;- character(0)\n  }\n}\n\n# Identify exclusive phylum for Mangrove system\nall_phylums &lt;- unique(unlist(phylum_unique))\nphylum_exclusive &lt;- list()\nfor (loc in names(phylum_unique)) {\n  other_locations &lt;- setdiff(names(phylum_unique), loc)\n  other_phylum &lt;- unique(unlist(phylum_unique[other_locations]))\n  exclusive_phylum &lt;- setdiff(phylum_unique[[loc]], other_phylum)\n  phylum_exclusive[[loc]] &lt;- exclusive_phylum\n  cat(\"Exclusive phylum in\", loc, \":\", length(exclusive_phylum), \"\\n\")\n  if (length(exclusive_phylum) &gt; 0) {\n    print(exclusive_phylum)\n  } else {\n    cat(\"There are not exclusive phylum.\\n\")\n  }\n}\n\nExclusive phylum in Celestún Lagoon : 5 \n[1] \"SAR324_clade(Marine_group_B)\" \"RCP2-54\"                     \n[3] \"Caldatribacteriota\"           \"CK-2C2-2\"                    \n[5] \"Nitrospinota\"                \nExclusive phylum in Fossil Lagoon : 12 \n [1] \"Patescibacteria\" \"Modulibacteria\"  \"Elusimicrobiota\" \"Halobacterota\"  \n [5] \"PAUC34f\"         \"Micrarchaeota\"   \"Hydrogenedentes\" \"LCP-89\"         \n [9] \"Cyanobacteria\"   \"Armatimonadota\"  \"Dependentiae\"    \"Acetothermia\"   \nExclusive phylum in San Pedro River : 3 \n[1] \"Dadabacteria\"     \"Abditibacteriota\" \"Sumerlaeota\"     \nExclusive phylum in Términos Lagoon : 0 \nThere are not exclusive phylum.\n\n\nFamily level\n\n# Create a list to store unique asv to specific taxonomy level\nfamilies_unique &lt;- list()\n\n# Iterate on each Mangrove system\nfor (loc in names(taxonomy_unique)) {\n  if (!is.null(taxonomy_unique[[loc]])) {\n    # Extract taxonomy families\n    tax_df &lt;- taxonomy_unique[[loc]]\n    if (\"Family\" %in% colnames(tax_df)) {\n      families &lt;- tax_df$Family\n      families &lt;- families[!is.na(families)]  # Exclude NA\n      families_unique[[loc]] &lt;- unique(families)\n    } else {\n      cat(\"Family is not available to\", loc, \"\\n\")\n      families_unique[[loc]] &lt;- character(0)\n    }\n  } else {\n    families_unique[[loc]] &lt;- character(0)\n  }\n}\n\n# Identify exclusive family for Mangrove system\nall_families &lt;- unique(unlist(families_unique))\nfamilies_exclusive &lt;- list()\nfor (loc in names(families_unique)) {\n  other_locations &lt;- setdiff(names(families_unique), loc)\n  other_families &lt;- unique(unlist(families_unique[other_locations]))\n  exclusive_families &lt;- setdiff(families_unique[[loc]], other_families)\n  families_exclusive[[loc]] &lt;- exclusive_families\n  cat(\"Exclusive family in\", loc, \":\", length(exclusive_families), \"\\n\")\n  if (length(exclusive_families) &gt; 0) {\n    print(exclusive_families)\n  } else {\n    cat(\"There are not exclusive family.\\n\")\n  }\n}\n\nExclusive family in Celestún Lagoon : 26 \n [1] \"OPB41\"                        \"SAR324_clade(Marine_group_B)\"\n [3] \"Hungateiclostridiaceae\"       \"MBAE14\"                      \n [5] \"RCP2-54\"                      \"Odinarchaeia\"                \n [7] \"Subgroup_9\"                   \"Nitrosomonadaceae\"           \n [9] \"EF100-94H03\"                  \"Desulfomonilaceae\"           \n[11] \"CCM11a\"                       \"FW22\"                        \n[13] \"JS1\"                          \"Microbulbiferaceae\"          \n[15] \"Ectothiorhodospiraceae\"       \"TG3\"                         \n[17] \"B2M28\"                        \"Caldilineaceae\"              \n[19] \"Nitrososphaeraceae\"           \"Subgroup_21\"                 \n[21] \"Gaiellaceae\"                  \"CK-2C2-2\"                    \n[23] \"Rhizobiales_Incertae_Sedis\"   \"Geothermarchaeaceae\"         \n[25] \"PS-B29\"                       \"P9X2b3D02\"                   \nExclusive family in Fossil Lagoon : 44 \n [1] \"Micropepsaceae\"          \"UBA10353_marine_group\"  \n [3] \"Bdellovibrionaceae\"      \"Gracilibacteria\"        \n [5] \"Moduliflexaceae\"         \"Lineage_IIc\"            \n [7] \"SM23-30\"                 \"Methanomicrobiaceae\"    \n [9] \"PAUC34f\"                 \"Nitrincolaceae\"         \n[11] \"MidBa8\"                  \"PAUC26f\"                \n[13] \"Bradymonadales\"          \"Solimonadaceae\"         \n[15] \"Simkaniaceae\"            \"67-14\"                  \n[17] \"vadinHA49\"               \"Micrarchaeales\"         \n[19] \"HOC36\"                   \"Melioribacteraceae\"     \n[21] \"Hydrogenedensaceae\"      \"Pla3_lineage\"           \n[23] \"LCP-89\"                  \"Rhodobacteraceae\"       \n[25] \"Micavibrionales\"         \"Desulfobacteraceae\"     \n[27] \"Pseudohongiellaceae\"     \"Nostocaceae\"            \n[29] \"VHS-B4-70\"               \"Dissulfuribacteraceae\"  \n[31] \"Run-SP154\"               \"Blastocatellaceae\"      \n[33] \"VHS-B3-70\"               \"Methylohalobiaceae\"     \n[35] \"SBYC\"                    \"Desulfovibrionaceae\"    \n[37] \"Vermiphilaceae\"          \"Kineosporiaceae\"        \n[39] \"Bacteroidetes_vadinHA17\" \"Syntrophobacteraceae\"   \n[41] \"Acetothermiia\"           \"Lentimicrobiaceae\"      \n[43] \"Haloadaptaceae\"          \"MD2894-B20\"             \nExclusive family in San Pedro River : 38 \n [1] \"Geopsychrobacteraceae\"  \"OM182_clade\"            \"Balneolaceae\"          \n [4] \"Subgroup_17\"            \"Sulfurovaceae\"          \"Dadabacteriales\"       \n [7] \"A4b\"                    \"Abditibacteriaceae\"     \"bacteriap25\"           \n[10] \"Marine_Benthic_Group_A\" \"t0.6.f\"                 \"Rhodospirillaceae\"     \n[13] \"Clostridiaceae\"         \"Thermoplasmata\"         \"Saccharospirillaceae\"  \n[16] \"Subgroup_2\"             \"DG-20\"                  \"Spongiibacteraceae\"    \n[19] \"Pla1_lineage\"           \"Desulfococcaceae\"       \"Thiomicrospiraceae\"    \n[22] \"Emcibacteraceae\"        \"Eel-36e1D6\"             \"Thermoplasmatota\"      \n[25] \"Sumerlaeaceae\"          \"KI89A_clade\"            \"PHOS-HE36\"             \n[28] \"Desulfurivibrionaceae\"  \"Planococcaceae\"         \"Hyphomonadaceae\"       \n[31] \"Colwelliaceae\"          \"SAR202_clade\"           \"Arcobacteraceae\"       \n[34] \"Thiotrichaceae\"         \"Myxococcaceae\"          \"C86\"                   \n[37] \"AB-539-J10\"             \"Bacteriovoracaceae\"    \nExclusive family in Términos Lagoon : 0 \nThere are not exclusive family.\n\n\nGet core table\n\n# Combine taxonomy in data.frame\ntaxonomy_unique_df &lt;- do.call(rbind, lapply(names(taxonomy_unique), function(loc) {\n  if (!is.null(taxonomy_unique[[loc]])) {\n    df &lt;- taxonomy_unique[[loc]]\n    df$Location &lt;- loc\n    df$ASV &lt;- rownames(df)# add name asv column\n    return(df)\n  } else {\n    return(NULL)\n  }\n}))\n\n# Move columns\ntaxonomy_unique_df &lt;- taxonomy_unique_df[, c(\"ASV\", \"Location\", setdiff(names(taxonomy_unique_df), c(\"ASV\", \"Location\")))]\n\n# show first rows of data.frame to verify\nprint(head(taxonomy_unique_df))\n\n                            ASV        Location     Kingdom\nKU578729.1.1383 KU578729.1.1383 Celestún Lagoon d__Bacteria\nJF344529.1.1525 JF344529.1.1525 Celestún Lagoon d__Bacteria\nJN483938.1.1414 JN483938.1.1414 Celestún Lagoon d__Bacteria\nHE804536.1.1436 HE804536.1.1436 Celestún Lagoon d__Bacteria\nDQ811792.1.1512 DQ811792.1.1512 Celestún Lagoon d__Bacteria\nAF354161.1.1421 AF354161.1.1421 Celestún Lagoon d__Bacteria\n                                      Phylum                        Class\nKU578729.1.1383            Verrucomicrobiota                  Omnitrophia\nJF344529.1.1525                      Sva0485                      Sva0485\nJN483938.1.1414                 Bacteroidota                  Bacteroidia\nHE804536.1.1436             Actinobacteriota               Coriobacteriia\nDQ811792.1.1512 SAR324_clade(Marine_group_B) SAR324_clade(Marine_group_B)\nAF354161.1.1421                Calditrichota                 Calditrichia\n                                       Order                       Family\nKU578729.1.1383                Omnitrophales               Omnitrophaceae\nJF344529.1.1525                      Sva0485                      Sva0485\nJN483938.1.1414                 Cytophagales            Cyclobacteriaceae\nHE804536.1.1436                        OPB41                        OPB41\nDQ811792.1.1512 SAR324_clade(Marine_group_B) SAR324_clade(Marine_group_B)\nAF354161.1.1421               Calditrichales              Calditrichaceae\n                                       Genus          Species\nKU578729.1.1383       Candidatus_Omnitrophus             &lt;NA&gt;\nJF344529.1.1525                      Sva0485             &lt;NA&gt;\nJN483938.1.1414                   uncultured             &lt;NA&gt;\nHE804536.1.1436                        OPB41             &lt;NA&gt;\nDQ811792.1.1512 SAR324_clade(Marine_group_B) uncultured_delta\nAF354161.1.1421              Calditrichaceae             &lt;NA&gt;\n\n\n\n# save data.frame\nwrite.csv(taxonomy_unique_df, file = \"Tables/SurfaceComparison/unique_asvs_taxonomy.csv\", row.names = FALSE)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#save-rds-core-plot",
    "href": "02.3.Coremicrobiome.html#save-rds-core-plot",
    "title": "Core microbiome",
    "section": "Save rds core plot",
    "text": "Save rds core plot\n\nsaveRDS(upset_plot, \"rds/compare_mangroves/upset_surface_plot.rds\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.2.BetaDiversity.html",
    "href": "02.2.BetaDiversity.html",
    "title": "Beta diversity",
    "section": "",
    "text": "Tip\n\n\n\nThe analysis of beta diversity was conducted using both NMDS and PERMANOVA to identify the factors that influenced the structure of the microbial community.",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Beta diversity"
    ]
  },
  {
    "objectID": "02.2.BetaDiversity.html#load-libraries-and-prepare-data",
    "href": "02.2.BetaDiversity.html#load-libraries-and-prepare-data",
    "title": "Beta diversity",
    "section": "Load libraries and prepare data",
    "text": "Load libraries and prepare data\n\n# load libraries\nlibrary(vegan)\nlibrary(phyloseq)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(pairwiseAdonis)\nlibrary(reshape2)\n\n\n#load data\nphyseq_qiime3 &lt;- readRDS(\"rds/compare_mangroves/physeq_qiime3.rds\")\n\n\n#Mangrove system colors\nloc_colors &lt;- c(\"Fossil Lagoon\"= \"#A7fcc1\",\n                \"San Pedro River\" = \"#26B170\",\n                \"Términos Lagoon\" = \"#329D9C\",\n                \"Celestún Lagoon\" = \"#41e8d3\")\n\n\n# Extract data from phyloseq object\n#library(phyloseq)\notu_data &lt;- otu_table(physeq_qiime3, taxa_are_rows = TRUE)\nmetadata &lt;- as(sample_data(physeq_qiime3), \"data.frame\")\n\nsample_data &lt;- data.frame(sample_data(physeq_qiime3))",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Beta diversity"
    ]
  },
  {
    "objectID": "02.2.BetaDiversity.html#nmds",
    "href": "02.2.BetaDiversity.html#nmds",
    "title": "Beta diversity",
    "section": "01. NMDS",
    "text": "01. NMDS\nGet distances and stress\n\n\n\n\n\n\nNote\n\n\n\nBray-Curtis dissimilarity distances are a measure of the dissimilarity between microbial communities based on their species composition.\n\n\n\n# library(vegan)\n# library(dplyr)\n# distances\nset.seed(123)\nbray=vegdist(t(otu_data), method = \"bray\")\nnmds_source_bray = vegan::metaMDS(bray, trymax = 20, k = 2)\n\nRun 0 stress 0.11 \nRun 1 stress 0.078 \n... New best solution\n... Procrustes: rmse 0.111  max resid 0.476 \nRun 2 stress 0.161 \nRun 3 stress 0.078 \n... Procrustes: rmse 4.1e-05  max resid 0.00012 \n... Similar to previous best\nRun 4 stress 0.11 \nRun 5 stress 0.133 \nRun 6 stress 0.11 \nRun 7 stress 0.078 \n... Procrustes: rmse 1.87e-05  max resid 6.06e-05 \n... Similar to previous best\nRun 8 stress 0.161 \nRun 9 stress 0.0782 \n... Procrustes: rmse 0.015  max resid 0.057 \nRun 10 stress 0.133 \nRun 11 stress 0.11 \nRun 12 stress 0.166 \nRun 13 stress 0.145 \nRun 14 stress 0.078 \n... Procrustes: rmse 4.39e-05  max resid 0.000144 \n... Similar to previous best\nRun 15 stress 0.0782 \n... Procrustes: rmse 0.015  max resid 0.0572 \nRun 16 stress 0.0782 \n... Procrustes: rmse 0.015  max resid 0.0571 \nRun 17 stress 0.155 \nRun 18 stress 0.0782 \n... Procrustes: rmse 0.015  max resid 0.0572 \nRun 19 stress 0.0782 \n... Procrustes: rmse 0.015  max resid 0.0571 \nRun 20 stress 0.078 \n... New best solution\n... Procrustes: rmse 4.37e-05  max resid 0.000133 \n... Similar to previous best\n*** Best solution repeated 1 times\n\n# stress\nvar_stress_nmds_bray &lt;- round(nmds_source_bray$stress, 5)\n\n# score\nscores_source_bray= nmds_source_bray %&gt;% vegan::scores()\n\nPlot\n\n# library(ggplot2)\n# library(tidyverse)\n\nnmds_plot_bray &lt;- ggplot() +\n  geom_point(data=data.frame(scores_source_bray) %&gt;%\n               rownames_to_column(var = \"SampleID\")%&gt;%\n               left_join(metadata, by = \"SampleID\"),\n             aes(x=NMDS1, y=NMDS2,  color = Mangrove.system, \n                 shape = Mangrove_type),\n             size=5) + theme_linedraw()+\n  scale_fill_manual(values = loc_colors)+\n  scale_color_manual(values = loc_colors)+\n  theme(axis.text = element_text(colour = \"black\", size = 12),\n        axis.title = element_text(colour = \"black\", size = 12),\n        legend.text = element_text(size = 10),\n        legend.title = element_text(size = 12),\n        legend.position = \"right\",\n        legend.box = \"vertical\")+ theme_classic() +\n  labs(title=\"Bray-Curtis distances\") +\n  ylab(\"NMDS2\")+xlab(\"NMDS1\")\n\n## stress legend\nnmds_plot_bray &lt;- nmds_plot_bray +\n  annotate(\"text\", x = Inf, y = -Inf,\n           label = paste(\"Stress:\", var_stress_nmds_bray),\n           hjust = 1.1, vjust = -1.1, size = 4)\n\n# show plot\nnmds_plot_bray",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Beta diversity"
    ]
  },
  {
    "objectID": "02.2.BetaDiversity.html#permanova",
    "href": "02.2.BetaDiversity.html#permanova",
    "title": "Beta diversity",
    "section": "02. PERMANOVA",
    "text": "02. PERMANOVA\n\n\n\n\n\n\nNote\n\n\n\nTo test the effects of Mangrove type and Mangrove system on the Bray-Curtis dissimilarity, a PERMANOVA analysis was conducted using adonis2.\n\n\n\n# Extract and transpose OTU table\notu_mat &lt;- t(otu_table(physeq_qiime3))\n\n# PERMANOVA with adonis2\nset.seed(123)\nadonis_result &lt;- adonis2(otu_mat ~ Mangrove_type * Mangrove.system,\n                         data = sample_data,\n                         method = \"bray\",\n                         permutations = 999,\n                         by = \"terms\")\n\n# show adonis result\nprint(adonis_result)\n\nPermutation test for adonis under reduced model\nTerms added sequentially (first to last)\nPermutation: free\nNumber of permutations: 999\n\nadonis2(formula = otu_mat ~ Mangrove_type * Mangrove.system, data = sample_data, permutations = 999, method = \"bray\", by = \"terms\")\n                Df SumOfSqs    R2     F Pr(&gt;F)    \nMangrove_type    1     1.77 0.283 11.60  0.001 ***\nMangrove.system  2     1.29 0.206  4.23  0.001 ***\nResidual        21     3.20 0.511                 \nTotal           24     6.25 1.000                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nPlot with PERMANOVA results\n\n#add to plot\nnmds_plot_bray_perm &lt;- nmds_plot_bray + annotate(\"text\", x = Inf, y = -Inf,\n           label = paste(\"PERMANOVA:\",\n                         \"Mangrove system: R² = 0.206, p = 0.001\\n\",\n                         \"Mangrove type: R² = 0.283, p = 0.001\\n\",\n                         \"Residual: R² = 0.511\"),\n           hjust = 1.1, vjust = -7, size = 4)\n\n# Mostrar el gráfico\nprint(nmds_plot_bray_perm)\n\n\n\n\n\n\n#save\nggsave(\"Figures/SurfaceComparison/beta-diversity.pdf\", nmds_plot_bray_perm, width = 7.3, height = 5.5)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Beta diversity"
    ]
  },
  {
    "objectID": "02.2.BetaDiversity.html#post-hoc-adonis",
    "href": "02.2.BetaDiversity.html#post-hoc-adonis",
    "title": "Beta diversity",
    "section": "03. Post-hoc adonis",
    "text": "03. Post-hoc adonis\n\n\n\n\n\n\nNote\n\n\n\nTo test differences between the Mangrove systems a Post-hoc pairwise PERMANOVA was conducted using pairwise.adonis\n\n\nPairwise adonis\n\n## Post-hoc Mangrove.system\n#library(pairwiseAdonis)\npairwise_adonis &lt;- pairwiseAdonis::pairwise.adonis2(otu_mat ~ \n                  Mangrove.system, data = sample_data, \n                  method = \"bray\",  permutations = 999)\n\nSet of permutations &lt; 'minperm'. Generating entire set.\n\nprint(pairwise_adonis)\n\n$parent_call\n[1] \"otu_mat ~ Mangrove.system , strata = Null , permutations 999\"\n\n$`San Pedro River_vs_Fossil Lagoon`\n         Df SumOfSqs    R2    F Pr(&gt;F)   \nModel     1    0.274 0.256 3.09  0.003 **\nResidual  9    0.798 0.744               \nTotal    10    1.071 1.000               \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n$`San Pedro River_vs_Celestún Lagoon`\n         Df SumOfSqs    R2    F Pr(&gt;F)    \nModel     1     1.39 0.378 9.73  0.001 ***\nResidual 16     2.28 0.622                \nTotal    17     3.67 1.000                \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n$`San Pedro River_vs_Términos Lagoon`\n         Df SumOfSqs    R2    F Pr(&gt;F)  \nModel     1     1.15 0.476 7.26  0.014 *\nResidual  8     1.26 0.524              \nTotal     9     2.41 1.000              \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n$`Fossil Lagoon_vs_Celestún Lagoon`\n         Df SumOfSqs    R2    F Pr(&gt;F)   \nModel     1     1.04 0.351 7.03  0.004 **\nResidual 13     1.93 0.649               \nTotal    14     2.98 1.000               \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n$`Fossil Lagoon_vs_Términos Lagoon`\n         Df SumOfSqs    R2    F Pr(&gt;F)  \nModel     1    1.005 0.523 5.48  0.035 *\nResidual  5    0.916 0.477              \nTotal     6    1.921 1.000              \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n$`Celestún Lagoon_vs_Términos Lagoon`\n         Df SumOfSqs    R2    F Pr(&gt;F)   \nModel     1     1.01 0.297 5.07  0.003 **\nResidual 12     2.40 0.703               \nTotal    13     3.41 1.000               \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nattr(,\"class\")\n[1] \"pwadstrata\" \"list\"      \n\n\nP-values matrix\n\n# heatmap \n# library(ggplot2)\n# library(reshape2)\n\n#  p-values of pairwise_adonis\np_values &lt;- c(\n  \"San Pedro River_vs_Fossil Lagoon\" = 0.004,\n  \"San Pedro River_vs_Celestún Lagoon\" = 0.001,\n  \"San Pedro River_vs_Términos Lagoon\" = 0.007,\n  \"Fossil Lagoon_vs_Celestún Lagoon\" = 0.001,\n  \"Fossil Lagoon_vs_Términos Lagoon\" = 0.02,\n  \"Celestún Lagoon_vs_Términos Lagoon\" = 0.003\n)\n\n# matrix of p-values\nlocations &lt;- c(\"San Pedro River\", \"Fossil Lagoon\", \"Celestún Lagoon\", \"Términos Lagoon\")\np_matrix &lt;- matrix(NA, nrow = length(locations), ncol = length(locations),\n                   dimnames = list(locations, locations))\n\n# Fill matrix with p-values (only for the upper half then make symmetrical)\npairs &lt;- strsplit(names(p_values), \"_vs_\")\nfor (i in seq_along(pairs)) {\n  row_name &lt;- pairs[[i]][1]\n  col_name &lt;- pairs[[i]][2]\n  p_matrix[row_name, col_name] &lt;- p_values[i]\n  p_matrix[col_name, row_name] &lt;- p_values[i]  # symmetrical\n}\ndiag(p_matrix) &lt;- 1  # compare with itself\n\n# long format\np_melt &lt;- melt(p_matrix)\n\nHeatmap of adonis posthoc\n\n# heatmap\nheatmap_plot &lt;- ggplot(p_melt, aes(x = Var1, y = Var2, fill = value)) +\n  geom_tile(color = \"white\") +\n  scale_fill_gradient2(low = \"blue\", mid = \"white\", high = \"red\",\n                       midpoint = 0.025, limits = c(0, 0.05),\n                       name = \"p-value\") +\n  geom_text(aes(label = sprintf(\"%.3f\", value)), color = \"black\", size = 3) +\n  theme_minimal() +\n  labs(title = \"Pairwise PERMANOVA post-hoc)\",\n       x = \"Mangrove system\", y = \"Mangrove system\") +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\n        axis.title = element_text(size = 12),\n        plot.title = element_text(size = 14))\n\n# Mostrar el gráfico\nprint(heatmap_plot)",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Beta diversity"
    ]
  },
  {
    "objectID": "02.2.BetaDiversity.html#beta-disper",
    "href": "02.2.BetaDiversity.html#beta-disper",
    "title": "Beta diversity",
    "section": "04. Beta disper",
    "text": "04. Beta disper\n\n\n\n\n\n\nNote\n\n\n\nTo validate the dissimilarity of the data, and to determine whether the differences found are due to changes in composition or to variations in dispersion within groups, the homogeneity of the dispersions between Mangrove type and Mangrove system was calculated using betadisper. Subsequently, the significance of the differences in dispersion was calculated with permutest\n\n\n\n# library(vegan)\n# library(phyloseq)\n# Bray distance matrix\ndist_matrix &lt;- phyloseq::distance(physeq_qiime3, method = \"bray\")\n\nBy Mangrove system\n\n# betadisper\ndisp_location &lt;- betadisper(dist_matrix, sample_data$Mangrove.system)\nprint(summary(disp_location))\n\n                Length Class  Mode   \neig              24    -none- numeric\nvectors         600    -none- numeric\ndistances        25    -none- numeric\ngroup            25    factor numeric\ncentroids        96    -none- numeric\ngroup.distances   4    -none- numeric\ncall              3    -none- call   \n\n\nPermutest\n\n# Significance permutest\nperm_location &lt;- permutest(disp_location, permutations = 999)\nprint(perm_location)\n\n\nPermutation test for homogeneity of multivariate dispersions\nPermutation: free\nNumber of permutations: 999\n\nResponse: Distances\n          Df Sum Sq Mean Sq    F N.Perm Pr(&gt;F)  \nGroups     3  0.143  0.0476 4.55    999  0.022 *\nResiduals 21  0.220  0.0105                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n# Plots\nplot(disp_location, main = \"Beta Dispersión por Mangrove system\")\n\n\n\n\n\n\nboxplot(disp_location, main = \"Distancias al centroide por Mangrove system\")\n\n\n\n\n\n\n\nBy Mangrove type\n\n# Betadisper Mangrove_type\ndisp_mangrove_type &lt;- betadisper(dist_matrix, sample_data$Mangrove_type)\nprint(summary(disp_mangrove_type))\n\n                Length Class  Mode   \neig              24    -none- numeric\nvectors         600    -none- numeric\ndistances        25    -none- numeric\ngroup            25    factor numeric\ncentroids        48    -none- numeric\ngroup.distances   2    -none- numeric\ncall              3    -none- call   \n\n# Significance permutest\nperm_mangrove_type &lt;- permutest(disp_mangrove_type, permutations = 999)\nprint(perm_mangrove_type)\n\n\nPermutation test for homogeneity of multivariate dispersions\nPermutation: free\nNumber of permutations: 999\n\nResponse: Distances\n          Df Sum Sq Mean Sq   F N.Perm Pr(&gt;F)  \nGroups     1  0.154  0.1537 7.2    999  0.014 *\nResiduals 23  0.491  0.0213                    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n# plots\nplot(disp_mangrove_type, main = \"Betadisper  Mangrove_type\")\n\n\n\n\n\n\nboxplot(disp_mangrove_type, main = \"Dist to centroid Mangrove_type\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Beta diversity"
    ]
  },
  {
    "objectID": "02.2.BetaDiversity.html#save-rds-beta-diversity-plot",
    "href": "02.2.BetaDiversity.html#save-rds-beta-diversity-plot",
    "title": "Beta diversity",
    "section": "Save rds beta diversity plot",
    "text": "Save rds beta diversity plot\n\nsaveRDS(nmds_plot_bray_perm, \"rds/compare_mangroves/beta-diversity-surface-plot.rds\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Beta diversity"
    ]
  },
  {
    "objectID": "02.SurfaceComparison.html",
    "href": "02.SurfaceComparison.html",
    "title": "Data Prepare",
    "section": "",
    "text": "How similar are coastal and inland mangroves❓\n\n\n\nTo answer this question, only samples that met the selection criteria were selected for comparison with each other. These samples were as follows:\n\nThey hailed from the same depth range.\nThey hailed from the strip, in the case of coastal mangroves.\nThey hailed from the flooding season, in the case of coastal mangroves.",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Data Prepare"
    ]
  },
  {
    "objectID": "02.SurfaceComparison.html#select-samples",
    "href": "02.SurfaceComparison.html#select-samples",
    "title": "Data Prepare",
    "section": "01. Select samples",
    "text": "01. Select samples\n\nlibrary(ggplot2)\nlibrary(qiime2R)\nlibrary(phyloseq)\n#Create phyloseq objects with qiime2 artifacts\nphyseq_qiime3 &lt;- qza_to_phyloseq(\n  features = \"data/cluster_table_filter_freq218_emcEstero.qza\",\n  taxonomy = \"data/taxonomyEstero.qza\",\n  metadata = \"data/metadata14.tsv\")\n\n\n#Filter metadata\n# Extract metadata from phyloseq object\nmetadat &lt;- data.frame(phyloseq::sample_data(physeq_qiime3), check.names = FALSE)\n\n\n#Filter metadata by Study_zone column\nfiltered_metadat &lt;- metadat[metadat$Study_zone %in% c(\"Estero_pargo\", \"Rio San Pedro\", \"Celestún\"), ]\n\n\n#Filter again by Ecological Type column, selecting Fringe parameter\nfiltered_metadat2 &lt;- filtered_metadat[filtered_metadat$Ecological_type %in% c(\"Fringe\"), ]\n\n\n#Filter again by season column to include all samples that were collected form a flood season\nfiltered_metadat3 &lt;- filtered_metadat2[filtered_metadat2$season %in%c(\"flood\"),]\n\n\n#Filter again by season column to include all samples that were collected form the surface\nfiltered_metadat4 &lt;- filtered_metadat3[filtered_metadat3$depth %in%c(\"0-15\", \"0.15\", \"5\"),]\n\n\n#Combine filtered metadata with phyloseq object to create a filtered phyloseq object\nfiltered_physeq2 &lt;- prune_samples(rownames(filtered_metadat4), physeq_qiime3)\n\n\n#Save your new phyloseq object\nsaveRDS(filtered_physeq2, file = \"physeq_objeto_Estero.rds\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Data Prepare"
    ]
  },
  {
    "objectID": "02.SurfaceComparison.html#data-preparation",
    "href": "02.SurfaceComparison.html#data-preparation",
    "title": "Data Prepare",
    "section": "02. Data preparation",
    "text": "02. Data preparation\n\n#load\nphyseq_qiime &lt;- readRDS(\"rds/compare_mangroves/physeq_objeto_Estero.rds\")\n\n02.1 Remove empty ASVs and singletons\n\n#check data\nlibrary(microbiome)\nlibrary(dplyr)\n\n\n#library(microbiome)\nmicrobiome::summarize_phyloseq(physeq_qiime)\n\nCompositional = NO2\n\n\n1] Min. number of reads = 35812] Max. number of reads = 1504313] Total number of reads = 19263064] Average number of reads = 77052.245] Median number of reads = 783677] Sparsity = 0.5742662632375196] Any OTU sum to 1 or less? YES8] Number of singletons = 849] Percent of OTUs that are singletons \n        (i.e. exactly one read detected across all samples)010] Number of sample variables are: 25SampleIDBioSampleIDSRASampleNameCollection_datedepthsiteelevationBroad_scale_environmental_contextLocal_scale_environmental_contextEnvironmental_mediumLatitude_and_LongitudeGeographic.LocationStudy_zoneEcological_typeParametrosTemperaturaSalinidadpHRedox.mVS.2SO4seasonfilter2\n\n\n[[1]]\n[1] \"1] Min. number of reads = 3581\"\n\n[[2]]\n[1] \"2] Max. number of reads = 150431\"\n\n[[3]]\n[1] \"3] Total number of reads = 1926306\"\n\n[[4]]\n[1] \"4] Average number of reads = 77052.24\"\n\n[[5]]\n[1] \"5] Median number of reads = 78367\"\n\n[[6]]\n[1] \"7] Sparsity = 0.574266263237519\"\n\n[[7]]\n[1] \"6] Any OTU sum to 1 or less? YES\"\n\n[[8]]\n[1] \"8] Number of singletons = 84\"\n\n[[9]]\n[1] \"9] Percent of OTUs that are singletons \\n        (i.e. exactly one read detected across all samples)0\"\n\n[[10]]\n[1] \"10] Number of sample variables are: 25\"\n\n[[11]]\n [1] \"SampleID\"                          \"BioSample\"                        \n [3] \"ID\"                                \"SRA\"                              \n [5] \"SampleName\"                        \"Collection_date\"                  \n [7] \"depth\"                             \"site\"                             \n [9] \"elevation\"                         \"Broad_scale_environmental_context\"\n[11] \"Local_scale_environmental_context\" \"Environmental_medium\"             \n[13] \"Latitude_and_Longitude\"            \"Geographic.Location\"              \n[15] \"Study_zone\"                        \"Ecological_type\"                  \n[17] \"Parametros\"                        \"Temperatura\"                      \n[19] \"Salinidad\"                         \"pH\"                               \n[21] \"Redox.mV\"                          \"S.2\"                              \n[23] \"SO4\"                               \"season\"                           \n[25] \"filter\"                           \n\n\n\n# get sums\ntaxa_sums &lt;- taxa_sums(physeq_qiime)\n# Identify ASVs with sum 0 present in all samples\nzero_taxa &lt;- taxa_names(physeq_qiime)[taxa_sums == 0]\n# Remove ASVs with sum 0\nphyseq_qiime2 &lt;- prune_taxa(!taxa_names(physeq_qiime) %in%\n                                zero_taxa, physeq_qiime)\n\n# Remove singletons\nphyseq_qiime3 &lt;- filter_taxa(physeq_qiime2, function(x) sum(x) &gt; 1, TRUE)\n\n02.2 Rename mangrove system\n\n# Extract metadata\nmetadata &lt;- as(sample_data(physeq_qiime3), \"data.frame\")\n\n# Rename specific levels in the Mangrove system column\n#library(dplyr)\nmetadata &lt;- metadata %&gt;%\n  mutate(`Mangrove system` = case_when(\n    Study_zone == \"Rio San Pedro\" ~ \"San Pedro River\",\n    Study_zone == \"Laguna Cacahuate\" ~ \"Fossil Lagoon\",\n    Study_zone == \"Estero_pargo\" ~ \"Términos Lagoon\",\n    Study_zone == \"Celestún\" ~ \"Celestún Lagoon\",\n    TRUE ~ Study_zone))\n\n02.3 Add mangrove type\n\n# Extract sample_data\nsample_data_df &lt;- as(sample_data(physeq_qiime3), \"data.frame\")\n\n# Join sample_data with metadata to add Mangrove system\nsample_data_df &lt;- sample_data_df %&gt;%\n  left_join(dplyr::select(metadata, SampleID, `Mangrove system`), by = \"SampleID\")\n\n# Create Mangrove_type\nsample_data_df &lt;- sample_data_df %&gt;%\n  mutate(Mangrove_type = case_when(\n    `Mangrove system` %in% c(\"Fossil Lagoon\", \"San Pedro River\") ~ \"Interior\",\n    `Mangrove system` %in% c(\"Celestún Lagoon\", \"Términos Lagoon\") ~ \"Coastal\",\n    TRUE ~ NA_character_\n  ))\n\n# add .fastq.gz to SampleID \nsample_data_df$SampleID &lt;- gsub(\"_R1$\", \"_R1.fastq.gz\", sample_data_df$SampleID)\n\n# add rownames as SampleID\nrownames(sample_data_df) &lt;- sample_data_df$SampleID\n\n# update sample_data in phyloseq object\nsample_data(physeq_qiime3) &lt;- sample_data(sample_data_df)\n\n# check\ntail(sample_data(physeq_qiime3))\n\n                                   SampleID    BioSample  ID          SRA\nSRR9973332                       SRR9973332 SAMN12325037 Cel        TM5.8\nSRR9973344                       SRR9973344 SAMN12325034 Cel        TM5.5\nSRR9973347                       SRR9973347 SAMN12325033 Cel        TM5.4\nzr2502_14_R1.fastq.gz zr2502_14_R1.fastq.gz                E zr2502_14_R1\nzr2502_1_R1.fastq.gz   zr2502_1_R1.fastq.gz                E  zr2502_1_R1\nzr2502_37_R1.fastq.gz zr2502_37_R1.fastq.gz                E zr2502_37_R1\n                      SampleName Collection_date depth site elevation\nSRR9973332            SRS5272925      2018-10-04  0.15              3\nSRR9973344            SRS5272913      2018-10-04  0.15              3\nSRR9973347            SRS5272910      2018-10-04  0.15              3\nzr2502_14_R1.fastq.gz                 17/01/2018     5             NA\nzr2502_1_R1.fastq.gz                  17/01/2018     5             NA\nzr2502_37_R1.fastq.gz                 30/05/2018     5             NA\n                      Broad_scale_environmental_context\nSRR9973332                                ENVO:01000181\nSRR9973344                                ENVO:01000181\nSRR9973347                                ENVO:01000181\nzr2502_14_R1.fastq.gz                                  \nzr2502_1_R1.fastq.gz                                   \nzr2502_37_R1.fastq.gz                                  \n                      Local_scale_environmental_context Environmental_medium\nSRR9973332                                ENVO:00000057             sediment\nSRR9973344                                ENVO:00000057             sediment\nSRR9973347                                ENVO:00000057             sediment\nzr2502_14_R1.fastq.gz                                                       \nzr2502_1_R1.fastq.gz                                                        \nzr2502_37_R1.fastq.gz                                                       \n                      Latitude_and_Longitude Geographic.Location   Study_zone\nSRR9973332                   20.85 N 90.37 W      Mexico:Yucatan     Celestún\nSRR9973344                   20.85 N 90.37 W      Mexico:Yucatan     Celestún\nSRR9973347                   20.85 N 90.37 W      Mexico:Yucatan     Celestún\nzr2502_14_R1.fastq.gz                            Mexico:Campeche Estero_pargo\nzr2502_1_R1.fastq.gz                             Mexico:Campeche Estero_pargo\nzr2502_37_R1.fastq.gz                            Mexico:Campeche Estero_pargo\n                      Ecological_type Parametros Temperatura Salinidad pH\nSRR9973332                     Fringe         no          NA        NA NA\nSRR9973344                     Fringe         no          NA        NA NA\nSRR9973347                     Fringe         no          NA        NA NA\nzr2502_14_R1.fastq.gz          Fringe         no          NA        NA NA\nzr2502_1_R1.fastq.gz           Fringe         no          NA        NA NA\nzr2502_37_R1.fastq.gz          Fringe         no          NA        NA NA\n                      Redox.mV S.2 SO4 season filter Mangrove.system\nSRR9973332                  NA  NA  NA  flood     si Celestún Lagoon\nSRR9973344                  NA  NA  NA  flood     si Celestún Lagoon\nSRR9973347                  NA  NA  NA  flood     si Celestún Lagoon\nzr2502_14_R1.fastq.gz       NA  NA  NA  flood     si Términos Lagoon\nzr2502_1_R1.fastq.gz        NA  NA  NA  flood     si Términos Lagoon\nzr2502_37_R1.fastq.gz       NA  NA  NA  flood     si Términos Lagoon\n                      Mangrove_type\nSRR9973332                  Coastal\nSRR9973344                  Coastal\nSRR9973347                  Coastal\nzr2502_14_R1.fastq.gz       Coastal\nzr2502_1_R1.fastq.gz        Coastal\nzr2502_37_R1.fastq.gz       Coastal\n\n\n02.4 Create color pallete\n\n#Mangrove system colors\nloc_colors &lt;- c(\"Fossil Lagoon\"= \"#A7fcc1\",\n                \"San Pedro River\" = \"#26B170\",\n                \"Términos Lagoon\" = \"#329D9C\",\n                \"Celestún Lagoon\" = \"#41e8d3\")\n\n#Mangrove type colors\nmt_colors &lt;- c(\"Interior\"= \"#A7fcc1\",\n                \"Coastal\" = \"#41e8d3\")\n\n02.5 Check samples\n\n# Samples Plot\nmetadata &lt;- as(sample_data(physeq_qiime3), \"data.frame\")\n\nsamples_plot &lt;- ggplot(metadata, aes(x = Mangrove.system, y = ..count..,\nfill = Mangrove.system)) + geom_bar(position = \"dodge\") +\n  facet_wrap(~ Mangrove_type, scales = \"free_x\") +\n  labs(title = \"Samples of the analysis\", y = \"Number of Samples\",\n       x = \"Mangrove system\") +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 0)) +\n  scale_fill_manual(values = loc_colors)\n\n# show plot\nprint(samples_plot)\n\nWarning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.\nℹ Please use `after_stat(count)` instead.\n\n\n\n\n\n\n\n\n02.6 Save objects in RDS to next analysis\n\nsaveRDS(physeq_qiime3, \"rds/compare_mangroves/physeq_qiime3.rds\")",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Data Prepare"
    ]
  },
  {
    "objectID": "A_InteriorCoastalCompare.html",
    "href": "A_InteriorCoastalCompare.html",
    "title": "Interior and coastal mangroves compare",
    "section": "",
    "text": "This section focuses on comparisons between inland and coastal mangroves in order to answer the following questions:\nHow are coastal and inland mangroves similar?\nHow are coastal and inland mangroves similar, considering their depth?\nHow are inland mangroves similar to a degraded coastal mangrove?",
    "crumbs": [
      "Interior and coastal mangroves compare"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#get-core-taxonomy",
    "href": "02.3.Coremicrobiome.html#get-core-taxonomy",
    "title": "Core microbiome",
    "section": "06. Get core taxonomy",
    "text": "06. Get core taxonomy\n\nshared_asvs &lt;- Reduce(intersect, core_list)\nprint(shared_asvs)\n\n[1] \"DQ811808.1.1527\" \"EU652571.1.1503\" \"GQ249585.1.1531\" \"AM176885.1.1418\"\n[5] \"FJ203391.1.1488\" \"FJ712534.1.1514\"\n\n\n\nshared_taxonomy &lt;- get_taxonomy(shared_asvs)\nprint(shared_taxonomy)\n\n                    Kingdom           Phylum               Class\nDQ811808.1.1527 d__Bacteria           MBNT15              MBNT15\nEU652571.1.1503 d__Bacteria   Proteobacteria Gammaproteobacteria\nGQ249585.1.1531 d__Bacteria Desulfobacterota     Desulfobacteria\nAM176885.1.1418 d__Bacteria   Proteobacteria Alphaproteobacteria\nFJ203391.1.1488 d__Bacteria            NB1-j               NB1-j\nFJ712534.1.1514 d__Bacteria    Calditrichota        Calditrichia\n                            Order             Family           Genus\nDQ811808.1.1527            MBNT15             MBNT15          MBNT15\nEU652571.1.1503   Nitrosococcales   Nitrosococcaceae            AqS1\nGQ249585.1.1531 Desulfobacterales Desulfosarcinaceae            &lt;NA&gt;\nAM176885.1.1418        uncultured         uncultured      uncultured\nFJ203391.1.1488             NB1-j              NB1-j           NB1-j\nFJ712534.1.1514    Calditrichales    Calditrichaceae Calditrichaceae\n                                        Species\nDQ811808.1.1527 uncultured_Syntrophobacteraceae\nEU652571.1.1503            uncultured_bacterium\nGQ249585.1.1531                            &lt;NA&gt;\nAM176885.1.1418     uncultured_Rhodobacteraceae\nFJ203391.1.1488                            &lt;NA&gt;\nFJ712534.1.1514                            &lt;NA&gt;\n\n\n\nshared_family &lt;- unique(shared_taxonomy$Family[!is.na(shared_taxonomy$Family)])\nprint(shared_family)\n\n[1] \"MBNT15\"             \"Nitrosococcaceae\"   \"Desulfosarcinaceae\"\n[4] \"uncultured\"         \"NB1-j\"              \"Calditrichaceae\"   \n\n\n\nshared_phyla &lt;- unique(shared_taxonomy$Phylum[!is.na(shared_taxonomy$Phylum)])\nprint(shared_phyla)\n\n[1] \"MBNT15\"           \"Proteobacteria\"   \"Desulfobacterota\" \"NB1-j\"           \n[5] \"Calditrichota\"",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  },
  {
    "objectID": "02.3.Coremicrobiome.html#relative-abundance-of-core-asv",
    "href": "02.3.Coremicrobiome.html#relative-abundance-of-core-asv",
    "title": "Core microbiome",
    "section": "07. Relative abundance of core asv",
    "text": "07. Relative abundance of core asv\n\n# Filter\nphyseq_shared &lt;- prune_taxa(shared_asvs, physeq_qiime3)\notu_table(physeq_shared)\n\nOTU Table:          [6 taxa and 25 samples]\n                     taxa are rows\n                S1A015 S1B07 S2B07 S3A07 S4B07 S5A07 S5B07 S6A07 S6B07 S7A07\nDQ811808.1.1527    115   194    59   108    72   216   140    57   182    80\nEU652571.1.1503   5951 12881  5260  8577  6118 13519  8852  6312 11648  5638\nGQ249585.1.1531     67    75    33    19   283    23   112   231   217   284\nAM176885.1.1418    348   658   261   463   292   762   513   402   861   372\nFJ203391.1.1488      2    38    43    16    44    21    51    67     7    72\nFJ712534.1.1514    189    72    32     7   213   114    95   543   365   489\n                S7B07 SRR9973320 SRR9973321 SRR9973322 SRR9973323 SRR9973324\nDQ811808.1.1527    70        853        734        163          7        704\nEU652571.1.1503  5563        397        834         42          8        443\nGQ249585.1.1531   305        214        341        367         23        425\nAM176885.1.1418   270          9         22         13          4         90\nFJ203391.1.1488    28         24         16         13          0         11\nFJ712534.1.1514   380          8         29         12        152          8\n                SRR9973326 SRR9973327 SRR9973331 SRR9973332 SRR9973344\nDQ811808.1.1527        218        345        326        117       1206\nEU652571.1.1503        133        127         58          0        571\nGQ249585.1.1531        122        616        611         37        567\nAM176885.1.1418         34         61         43         17         16\nFJ203391.1.1488          4          8          7          2          9\nFJ712534.1.1514          4         18         42         14         24\n                SRR9973347 zr2502_14_R1.fastq.gz zr2502_1_R1.fastq.gz\nDQ811808.1.1527       1375                   354                   13\nEU652571.1.1503        565                    33                  205\nGQ249585.1.1531        522                    23                   33\nAM176885.1.1418        161                   109                   39\nFJ203391.1.1488         14                    10                   29\nFJ712534.1.1514         54                    28                   72\n                zr2502_37_R1.fastq.gz\nDQ811808.1.1527                   343\nEU652571.1.1503                   286\nGQ249585.1.1531                    16\nAM176885.1.1418                    31\nFJ203391.1.1488                    19\nFJ712534.1.1514                    58\n\n# rel abundance\nphyseq_rel &lt;- transform_sample_counts(physeq_shared, function(x){x / sum(x)})\notu_table(physeq_shared)\n\nOTU Table:          [6 taxa and 25 samples]\n                     taxa are rows\n                S1A015 S1B07 S2B07 S3A07 S4B07 S5A07 S5B07 S6A07 S6B07 S7A07\nDQ811808.1.1527    115   194    59   108    72   216   140    57   182    80\nEU652571.1.1503   5951 12881  5260  8577  6118 13519  8852  6312 11648  5638\nGQ249585.1.1531     67    75    33    19   283    23   112   231   217   284\nAM176885.1.1418    348   658   261   463   292   762   513   402   861   372\nFJ203391.1.1488      2    38    43    16    44    21    51    67     7    72\nFJ712534.1.1514    189    72    32     7   213   114    95   543   365   489\n                S7B07 SRR9973320 SRR9973321 SRR9973322 SRR9973323 SRR9973324\nDQ811808.1.1527    70        853        734        163          7        704\nEU652571.1.1503  5563        397        834         42          8        443\nGQ249585.1.1531   305        214        341        367         23        425\nAM176885.1.1418   270          9         22         13          4         90\nFJ203391.1.1488    28         24         16         13          0         11\nFJ712534.1.1514   380          8         29         12        152          8\n                SRR9973326 SRR9973327 SRR9973331 SRR9973332 SRR9973344\nDQ811808.1.1527        218        345        326        117       1206\nEU652571.1.1503        133        127         58          0        571\nGQ249585.1.1531        122        616        611         37        567\nAM176885.1.1418         34         61         43         17         16\nFJ203391.1.1488          4          8          7          2          9\nFJ712534.1.1514          4         18         42         14         24\n                SRR9973347 zr2502_14_R1.fastq.gz zr2502_1_R1.fastq.gz\nDQ811808.1.1527       1375                   354                   13\nEU652571.1.1503        565                    33                  205\nGQ249585.1.1531        522                    23                   33\nAM176885.1.1418        161                   109                   39\nFJ203391.1.1488         14                    10                   29\nFJ712534.1.1514         54                    28                   72\n                zr2502_37_R1.fastq.gz\nDQ811808.1.1527                   343\nEU652571.1.1503                   286\nGQ249585.1.1531                    16\nAM176885.1.1418                    31\nFJ203391.1.1488                    19\nFJ712534.1.1514                    58\n\n\n\n# Aggregate data by Mangrove_system\nphyseq_agg &lt;- merge_samples(physeq_rel, \"Mangrove_system\")\n\n# Convert to relative abundance\nphyseq_agg_rel &lt;- transform_sample_counts(physeq_agg, function(x) x / sum(x))\n\n# Map Mangrove_type back as a simple vector\nsample_data(physeq_agg_rel)$Mangrove_type &lt;- unlist(sapply(sample_names(physeq_agg_rel), function(sys) {\n  unique(sample_data(physeq_rel)[sample_data(physeq_rel)$Mangrove_system == sys, \"Mangrove_type\"])[1]\n}))\n\n\n# Create the bar plot with facet by Mangrove_type\nbarplot_core &lt;- phyloseq::plot_bar(physeq_agg_rel, fill = \"Family\") +\n    geom_bar(aes(color = Family, fill = Family), stat = \"identity\", position = \"stack\") +\n    labs(x = \"\", y = \"Relative Abundance\", element_text(size = 9)) +\n    facet_wrap(~ Mangrove_type, scales = \"free_x\", nrow = 1) +\n    scale_fill_manual(values = c(\"#2B0082\", \"#54278F\", \"#724BB1\", \"#706AF5\", \"#706BB1\", \"#BCBDDC\", \"#DADAEB\")) +\n    scale_color_manual(values = c(\"#2B0082\", \"#54278F\", \"#724BB1\", \"#706AF5\", \"#706BB1\", \"#BCBDDC\", \"#DADAEB\")) +\n  theme(axis.text = element_text(colour = \"black\", size = 10),\n        axis.title = element_text(colour = \"black\", size = 10),\n        legend.text = element_text(size = 9),\n        legend.title = element_text(size = 10),\n        axis.text.x = element_text(size = 9, angle = 0, \n                        hjust = 0.5, color = \"black\"),\n      axis.text.y = element_text(size = 9, color = \"black\"),\n      #strip.background = element_blank(),\n      panel.background = element_blank())\n\nbarplot_core\n\n\n\n\n\n\n\n\npdf(\"Figures/SurfaceComparison/rel_abun_core.pdf\")\nbarplot_core\ndev.off()\n\nquartz_off_screen \n                2",
    "crumbs": [
      "Interior and coastal mangroves compare",
      "How similar are coastal and inland mangroves?",
      "Analysis",
      "Core microbiome"
    ]
  }
]